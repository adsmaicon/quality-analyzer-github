[{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4748","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4748/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4748/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4748/events","html_url":"https://github.com/tiangolo/fastapi/issues/4748","id":1188289918,"node_id":"I_kwDOCZduT85G091-","number":4748,"title":"How to create a WebSocket with multiple \"routes\" / \"endpoints\"","user":{"login":"PierroD","id":40763427,"node_id":"MDQ6VXNlcjQwNzYzNDI3","avatar_url":"https://avatars.githubusercontent.com/u/40763427?v=4","gravatar_id":"","url":"https://api.github.com/users/PierroD","html_url":"https://github.com/PierroD","followers_url":"https://api.github.com/users/PierroD/followers","following_url":"https://api.github.com/users/PierroD/following{/other_user}","gists_url":"https://api.github.com/users/PierroD/gists{/gist_id}","starred_url":"https://api.github.com/users/PierroD/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PierroD/subscriptions","organizations_url":"https://api.github.com/users/PierroD/orgs","repos_url":"https://api.github.com/users/PierroD/repos","events_url":"https://api.github.com/users/PierroD/events{/privacy}","received_events_url":"https://api.github.com/users/PierroD/received_events","type":"User","site_admin":false},"labels":[{"id":1154536363,"node_id":"MDU6TGFiZWwxMTU0NTM2MzYz","url":"https://api.github.com/repos/tiangolo/fastapi/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-03-31T15:46:57Z","updated_at":"2022-03-31T15:46:57Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### First Check\n\n- [X] I added a very descriptive title to this issue.\n- [X] I used the GitHub search to find a similar issue and didn't find it.\n- [X] I searched the FastAPI documentation, with the integrated search.\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\n\n### Commit to Help\n\n- [X] I commit to help with one of those options 👆\n\n### Example Code\n\n```python\n# What I'm doing\r\n\r\napp = FastAPI()\r\n\r\n@app.websocket(\"/ws\")\r\nasync def websocket_endpoint(websocket: WebSocket):\r\n    await manager.connect(websocket)\r\n    try:\r\n        while True:\r\n            json = await websocket.receive_json()\r\n            response = await websocket_parser(json)\r\n            if(response):\r\n                await manager.send_response(response)\r\n            else:\r\n                manager.disconnect(websocket)\r\n    except WebSocketDisconnect:\r\n        manager.disconnect(websocket)\r\n\r\n# VS what I'm looking for, I know this is NodeJs, but I'm looking for a python way to do it\r\nio.on(\"connection\", socket => {\r\n    socket.on(\"phone.calling\", (sessionDescription) => {\r\n        console.log('Someone is calling');\r\n        socket.broadcast.emit('phone.call', sessionDescription);\r\n    });\r\n\r\n    socket.on(\"phone.answer\", (answer) => {\r\n        console.log('Annswer to phone');\r\n        socket.broadcast.emit('phone.answer', answer);\r\n    });\r\n});\n```\n\n\n### Description\n\nI'm looking for a way to create an instance of my WS, and define multiple \"routes\" / \"endpoints\" that could be used in that specific WS.\r\n\r\nMaybe something like \r\n```py\r\nws = websocket.define(\"/ws\")\r\n@ws.add_websocket_route(\"connect\")\r\n   def ws_connect(websocket: WebSocket):\r\n       ...\r\n@ws.add_websocket_route(\"phone.calling\")\r\n   def ws_phone_calling(websocket: WebSocket):\r\n      ...\r\n```\r\n\r\nI found many functions in fastAPI that could do the tricks, but I don't really know if they were built for it :\r\n```py\r\n@websocket.add_api_websocket_route\r\n@websocket.add_websocket_route\r\n@websocket.add_route\r\n```\r\n\r\nIf you have any Idea :pray: \r\n\r\n\n\n### Operating System\n\nLinux\n\n### Operating System Details\n\nZorinOS 16 Pro\n\n### FastAPI Version\n\n0.70.0\n\n### Python Version\n\n3.8.10\n\n### Additional Context\n\n_No response_","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4748/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4748/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4747","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4747/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4747/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4747/events","html_url":"https://github.com/tiangolo/fastapi/issues/4747","id":1188200056,"node_id":"I_kwDOCZduT85G0n54","number":4747,"title":"[SUGGESTION] Consider separating documentation into own repo so translators can update translations without needs to push up versions.","user":{"login":"v3ss0n","id":419606,"node_id":"MDQ6VXNlcjQxOTYwNg==","avatar_url":"https://avatars.githubusercontent.com/u/419606?v=4","gravatar_id":"","url":"https://api.github.com/users/v3ss0n","html_url":"https://github.com/v3ss0n","followers_url":"https://api.github.com/users/v3ss0n/followers","following_url":"https://api.github.com/users/v3ss0n/following{/other_user}","gists_url":"https://api.github.com/users/v3ss0n/gists{/gist_id}","starred_url":"https://api.github.com/users/v3ss0n/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/v3ss0n/subscriptions","organizations_url":"https://api.github.com/users/v3ss0n/orgs","repos_url":"https://api.github.com/users/v3ss0n/repos","events_url":"https://api.github.com/users/v3ss0n/events{/privacy}","received_events_url":"https://api.github.com/users/v3ss0n/received_events","type":"User","site_admin":false},"labels":[{"id":1154536363,"node_id":"MDU6TGFiZWwxMTU0NTM2MzYz","url":"https://api.github.com/repos/tiangolo/fastapi/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-03-31T14:43:22Z","updated_at":"2022-03-31T15:27:18Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### Description\r\n\r\n* Came back to fastapi after 3 months of not using it.\r\nSees a lot of Update Release Notes . But actually alll of them are adding new translation.\r\n* Expected  : FastAPI getting some love from the maintainer and flourishing.\r\n* Currently : No new changes , no new features merged , several bugs are still open even though contributors had contributed pull requests for bugs and features . All commits are just translations added and versions are shamelessly bumped\r\n\r\nPushing versions without any new fixes or features is not really honest way of showing the project as active , its deceiving.\r\n\r\n### Suggestion \r\n- Separate Documentation into its own repo , that way documentation can be updated without pushing up versions \r\n","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4747/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4747/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4746","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4746/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4746/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4746/events","html_url":"https://github.com/tiangolo/fastapi/issues/4746","id":1188132683,"node_id":"I_kwDOCZduT85G0XdL","number":4746,"title":"request.session in HTTP Middleware","user":{"login":"sagar-arya","id":99640566,"node_id":"U_kgDOBfBk9g","avatar_url":"https://avatars.githubusercontent.com/u/99640566?v=4","gravatar_id":"","url":"https://api.github.com/users/sagar-arya","html_url":"https://github.com/sagar-arya","followers_url":"https://api.github.com/users/sagar-arya/followers","following_url":"https://api.github.com/users/sagar-arya/following{/other_user}","gists_url":"https://api.github.com/users/sagar-arya/gists{/gist_id}","starred_url":"https://api.github.com/users/sagar-arya/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sagar-arya/subscriptions","organizations_url":"https://api.github.com/users/sagar-arya/orgs","repos_url":"https://api.github.com/users/sagar-arya/repos","events_url":"https://api.github.com/users/sagar-arya/events{/privacy}","received_events_url":"https://api.github.com/users/sagar-arya/received_events","type":"User","site_admin":false},"labels":[{"id":1154536363,"node_id":"MDU6TGFiZWwxMTU0NTM2MzYz","url":"https://api.github.com/repos/tiangolo/fastapi/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-03-31T14:01:38Z","updated_at":"2022-03-31T14:01:38Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### First Check\n\n- [X] I added a very descriptive title to this issue.\n- [X] I used the GitHub search to find a similar issue and didn't find it.\n- [X] I searched the FastAPI documentation, with the integrated search.\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\n\n### Commit to Help\n\n- [X] I commit to help with one of those options 👆\n\n### Example Code\n\n```python\nfrom fastapi import FastAPI\r\nfrom starlette.middleware.sessions import SessionMiddleware\r\napp = FastAPI()\r\napp.add_middleware(SessionMiddleware, secret_key=\"SECRET_KEY\")\r\n\r\n@app.middleware(\"http\")\r\nasync def validate_user(request: Request, call_next):\r\n    end_point = request.url.path\r\n    request.session[\"name\"] = \"some random value\"\r\n    response = await call_next(request)\r\n    return response\n```\n\n\n### Description\n\nThis is a basic example of my app.\r\nI am trying to add values into the session if the user is valid.\r\nFor now, I am trying to set \r\n```\r\nrequest.session[\"name\"] = \"some random value\"\r\n```\r\nIn the process, I get SessionMiddleware must be installed to access request.session\r\n```\r\nAssertionError: SessionMiddleware must be installed to access request.session\r\n```\r\nIs there any other way for solving it?\r\nI am able to set it using\r\n```\r\nrequest.state.name=\"some random value\"\r\n```\r\nI am not sure if this is a valid way to do it or not.\r\nCan someone please help me with this?\r\n\n\n### Operating System\n\nmacOS\n\n### Operating System Details\n\n_No response_\n\n### FastAPI Version\n\n0.74.1\n\n### Python Version\n\n 3.10.2\n\n### Additional Context\n\n_No response_","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4746/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4746/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4745","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4745/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4745/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4745/events","html_url":"https://github.com/tiangolo/fastapi/issues/4745","id":1188071330,"node_id":"I_kwDOCZduT85G0Iei","number":4745,"title":"Endpoint response in swagger docs even without closing braces","user":{"login":"dunossauro","id":6801122,"node_id":"MDQ6VXNlcjY4MDExMjI=","avatar_url":"https://avatars.githubusercontent.com/u/6801122?v=4","gravatar_id":"","url":"https://api.github.com/users/dunossauro","html_url":"https://github.com/dunossauro","followers_url":"https://api.github.com/users/dunossauro/followers","following_url":"https://api.github.com/users/dunossauro/following{/other_user}","gists_url":"https://api.github.com/users/dunossauro/gists{/gist_id}","starred_url":"https://api.github.com/users/dunossauro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dunossauro/subscriptions","organizations_url":"https://api.github.com/users/dunossauro/orgs","repos_url":"https://api.github.com/users/dunossauro/repos","events_url":"https://api.github.com/users/dunossauro/events{/privacy}","received_events_url":"https://api.github.com/users/dunossauro/received_events","type":"User","site_admin":false},"labels":[{"id":1154536363,"node_id":"MDU6TGFiZWwxMTU0NTM2MzYz","url":"https://api.github.com/repos/tiangolo/fastapi/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-03-31T13:21:43Z","updated_at":"2022-03-31T13:21:55Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### First Check\n\n- [X] I added a very descriptive title to this issue.\n- [X] I used the GitHub search to find a similar issue and didn't find it.\n- [X] I searched the FastAPI documentation, with the integrated search.\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\n\n### Commit to Help\n\n- [ ] I commit to help with one of those options 👆\n\n### Example Code\n\n```python\nfrom fastapi import FastAPI\r\nfrom pydantic import BaseModel\r\n\r\n\r\nclass Response(BaseModel):\r\n    message: str\r\n\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.get('/user/{_id', response_model=Response)  # NOTE: The brace is open but not closed \r\ndef user(_id: int):\r\n    return {'message': f'Olá {_id}'}\n```\n\n\n### Description\n\nEndpoint response in swagger docs even without closing braces.\r\n\r\n## Swagger test:\r\n![image](https://user-images.githubusercontent.com/6801122/161063033-62f2f42f-3120-43b2-86fa-e0375367fcf1.png)\r\n\r\nThe same behavior does not occur in calls made by httpie or curl \r\n\r\n## Httpie tests:\r\n```\r\nhttp :8000/user/1\r\nHTTP/1.1 404 Not Found\r\ncontent-length: 22\r\ncontent-type: application/json\r\ndate: Thu, 31 Mar 2022 13:12:18 GMT\r\nserver: uvicorn\r\n\r\n{\r\n    \"detail\": \"Not Found\"\r\n}\r\n```\n\n### Operating System\n\nLinux\n\n### Operating System Details\n\n_No response_\n\n### FastAPI Version\n\n0.73.0\n\n### Python Version\n\n3.10\n\n### Additional Context\n\n_No response_","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4745/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4745/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4742","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4742/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4742/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4742/events","html_url":"https://github.com/tiangolo/fastapi/issues/4742","id":1187444154,"node_id":"I_kwDOCZduT85GxvW6","number":4742,"title":"How to best Access a DB Connection to perform queries on a Scheduled Task which is trigerred during Startup using ApScheduler","user":{"login":"ibiswas","id":17534534,"node_id":"MDQ6VXNlcjE3NTM0NTM0","avatar_url":"https://avatars.githubusercontent.com/u/17534534?v=4","gravatar_id":"","url":"https://api.github.com/users/ibiswas","html_url":"https://github.com/ibiswas","followers_url":"https://api.github.com/users/ibiswas/followers","following_url":"https://api.github.com/users/ibiswas/following{/other_user}","gists_url":"https://api.github.com/users/ibiswas/gists{/gist_id}","starred_url":"https://api.github.com/users/ibiswas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ibiswas/subscriptions","organizations_url":"https://api.github.com/users/ibiswas/orgs","repos_url":"https://api.github.com/users/ibiswas/repos","events_url":"https://api.github.com/users/ibiswas/events{/privacy}","received_events_url":"https://api.github.com/users/ibiswas/received_events","type":"User","site_admin":false},"labels":[{"id":1154536363,"node_id":"MDU6TGFiZWwxMTU0NTM2MzYz","url":"https://api.github.com/repos/tiangolo/fastapi/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-03-31T03:28:02Z","updated_at":"2022-03-31T05:32:57Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### First Check\n\n- [X] I added a very descriptive title to this issue.\n- [X] I used the GitHub search to find a similar issue and didn't find it.\n- [X] I searched the FastAPI documentation, with the integrated search.\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\n\n### Commit to Help\n\n- [X] I commit to help with one of those options 👆\n\n### Example Code\n\n```python\nI have a session.py file where the SQLAlchemy DB Conn is managed. The code is below\r\n----------------code----------\r\ndef get_db():\r\n    db = SessionLocal()\r\n    try:\r\n        logger.info(engine.pool.status())\r\n        yield db\r\n    finally:\r\n        logger.info(\"close connection\")\r\n        db.close()\r\n\r\n\r\ndef get_password(properties):\r\n    client = boto3.client('rds', region_name=properties['dbRegion'])\r\n    password = client.generate_db_auth_token(DBHostname=properties['rdsHost'], Port=properties['rdsPort'],\r\n                                             DBUsername=properties['rdsUsername'])\r\n    logger.debug(\"Generate db_auth_token successfully\")\r\n    return password\r\n\r\n\r\nSQLALCHEMY_DATABASE_URI = '{}://{}:{}@{}:{}/{}?ssl_ca={}'.format(config.DB_DIALECT,\r\n                                                                 config.DB_RDSUSERNAME,\r\n                                                                 urllib.parse.quote(\r\n                                                                     get_password({'rdsHost': config.DB_RDSHOST,\r\n                                                                                   'rdsPort': config.DB_RDSPORT,\r\n                                                                                   'rdsUsername': config.DB_RDSUSERNAME,\r\n                                                                                   'dbRegion': config.DB_REGION})),\r\n                                                                 config.DB_RDSHOST,\r\n                                                                 config.DB_RDSPORT,\r\n                                                                 config.DB_RDSSCHEMA,\r\n                                                                 config.DB_CERTIFICATE_PATH)\r\n\r\nengine = create_engine(  # 2\r\n    SQLALCHEMY_DATABASE_URI, pool_recycle=300, pool_pre_ping=True, pool_size=2\r\n)\r\n\r\nSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)  # 4\r\nBase = declarative_base()\r\n\r\n#Foe Job Scheduler\r\njobstores = {\r\n    'default': SQLAlchemyJobStore( engine=engine)\r\n}\r\n\r\n@event.listens_for(engine, \"do_connect\")\r\ndef receive_do_connect(dialect, conn_rec, cargs, cparams):\r\n    logger.info(\"Either pool is Invalidated or initializing so Acquiring DB Connection\")\r\n    secret = get_password({'rdsHost': config.DB_RDSHOST,\r\n                                              'rdsPort': config.DB_RDSPORT,\r\n                                              'rdsUsername': config.DB_RDSUSERNAME,\r\n                                              'dbRegion': config.DB_REGION})\r\n    cparams['password'] = secret\r\n------------------------Code End---------\r\nI'm able to Inject the DB Connection in my routers succesfully like below\r\n\r\n---------Code Block from a router.py file-----\r\n@mm_router.get(path=\"/orgs/{org_name}\", response_model=MmOrgResponseSchema,\r\n               description=\"\")\r\ndef get(org_name: str = Path(..., max_length=100, regex='^[a-zA-Z0-9 _]{5,100}$'), db: Session = Depends(get_db)):\r\n    try:\r\n        logger.info(f'GET: Get Organization Details for Org Name = {org_name}')\r\n        mm_org = ModelMonitoringSvc()\r\n        return mm_org.get_organization_by_org_name(org_name, db)\r\n    except HTTPException as he:\r\n        raise he\r\n    except Exception as e:\r\n        raise HTTPException(\"Something wrong happened\", 500)\r\n---------Code End--------\r\n\r\nIn my startup File I'm Creating a Scheduler with a call back method \"create_pending_roles\". How do I get the DB Access in that method similar to the Dependency Injection inmy Router Class. I tried to add the Dependency Injection on the Startup Event itself since it is managed by FASTAPI but didn't work thinking that I could pass the db session as a parameter to the scheduled callback\r\n\r\n---------Code Block--------\r\napp=FastAPI()\r\n@app.on_event(\"startup\")\r\nasync def startup_event():\r\n    scheduler = BackgroundScheduler()\r\n    scheduler.configure(jobstores=jobstores)\r\n    scheduler.add_job(create_pending_roles, trigger='interval',  seconds=60)\r\n    scheduler.start()\r\n--------Code Block--------\n```\n\n\n### Description\n\nPlease see example code block for description\n\n### Operating System\n\nWindows\n\n### Operating System Details\n\nWindows\n\n### FastAPI Version\n\n0.74.0\n\n### Python Version\n\n3.8.10\n\n### Additional Context\n\nNone","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4742/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4742/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4741","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4741/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4741/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4741/events","html_url":"https://github.com/tiangolo/fastapi/issues/4741","id":1186819305,"node_id":"I_kwDOCZduT85GvWzp","number":4741,"title":"Refreshing database connection pool every 30 days, using AWS, Sqlalchemy and FastAPI","user":{"login":"jordan-carson","id":7357108,"node_id":"MDQ6VXNlcjczNTcxMDg=","avatar_url":"https://avatars.githubusercontent.com/u/7357108?v=4","gravatar_id":"","url":"https://api.github.com/users/jordan-carson","html_url":"https://github.com/jordan-carson","followers_url":"https://api.github.com/users/jordan-carson/followers","following_url":"https://api.github.com/users/jordan-carson/following{/other_user}","gists_url":"https://api.github.com/users/jordan-carson/gists{/gist_id}","starred_url":"https://api.github.com/users/jordan-carson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jordan-carson/subscriptions","organizations_url":"https://api.github.com/users/jordan-carson/orgs","repos_url":"https://api.github.com/users/jordan-carson/repos","events_url":"https://api.github.com/users/jordan-carson/events{/privacy}","received_events_url":"https://api.github.com/users/jordan-carson/received_events","type":"User","site_admin":false},"labels":[{"id":1154536363,"node_id":"MDU6TGFiZWwxMTU0NTM2MzYz","url":"https://api.github.com/repos/tiangolo/fastapi/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2022-03-30T18:16:48Z","updated_at":"2022-03-31T19:57:38Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### First Check\r\n\r\n- [x] I added a very descriptive title to this issue.\r\n- [X] I used the GitHub search to find a similar issue and didn't find it.\r\n- [X] I searched the FastAPI documentation, with the integrated search.\r\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n\r\n### Commit to Help\r\n\r\n- [X] I commit to help with one of those options 👆\r\n\r\n### Example Code\r\n\r\n```python\r\nimport os\r\nimport time\r\nfrom uuid import uuid4\r\n\r\nimport uvicorn\r\nfrom fastapi import FastAPI, Request, Depends\r\nfrom fastapi.encoders import jsonable_encoder\r\nfrom api.routes.info import info, health\r\nfrom api.utils.db import init_db_sqlalchemy, get_session, fetch\r\n\r\napp = FastAPI(\r\n)\r\napp.include_router(info, prefix=\"/info\")\r\napp.include_router(health, prefix=\"/health\")\r\n\r\n\r\n@app.middleware(\"http\")\r\nasync def add_logging_and_process_time(request: Request, call_next):\r\n    start_time = time.time()\r\n    request_id = str(uuid4().hex)\r\n    response = await call_next(request)\r\n    process_time = time.time() - start_time\r\n    process_time = str(round(process_time * 1000))\r\n    response.headers[\"X-Process-Time-MS\"] = process_time\r\n    log_msg = f\"request_id={request_id} service=my-svc url={request.url} host={request.client.host} \" \\\r\n              f\"port={request.client.port} processing_time_ms={process_time} env={os.environ.get('APP_ENV')} \" \\\r\n              f\"version=v1 pid={os.getpid()} region={os.environ.get('REGION')} \"\r\n    logger.info(log_msg)\r\n    return response\r\n\r\n@app.on_event('startup')\r\ndef startup():\r\n    init_db_sqlalchemy()\r\n\r\n@app.get('/getDatabaseInfo')\r\ndef get_db_data_example(db: Session = Depends(get_session)):\r\n    try:\r\n        records = fetch(db, DATABASE_QUERY).all()\r\n        return jsonable_encoder(records)\r\n    except Exception as err:\r\n        logger.exception(f\"function_name=getDatabaseInfo error={err}\")\r\n\r\n\r\n\r\nif __name__ == '__main__':\r\n    uvicorn.run(app, host=\"0.0.0.0\", port=8050)\r\n```\r\n\r\n\r\n### Description\r\n\r\nCurrently using sqlalchemy and fastapi for a production microservice hosted in AWS. The issue is that our production database secrets are refreshed every 30 days. Trying to automatically fetch the new secrets from secrets manager to reinitialize the database engine and session in the event of an error or OperationalError from sqlalchemy.\r\nMy question is where should this \"reinitialization\" occur?\r\n\r\nutils/secret_mgr.py\r\n```python\r\nimport json\r\nimport logging\r\n\r\nimport boto3\r\nfrom botocore.exceptions import ClientError\r\n\r\n\r\ndef get_secret(secret_id):\r\n    session = boto3.client('secretsmanager', region_name='us-east-1')\r\n    try:\r\n        response = session.get_secret_value(SecretId=secret_id)\r\n    except ClientError as e:\r\n        code = e.response['Error']['Code']\r\n        logging.exception(f'error:get_secret error_code:{code}')\r\n        raise e\r\n    else:\r\n        secret_str = response['SecretString']\r\n        secret = json.loads(secret_str)\r\n    return secret\r\n\r\n```\r\n\r\n\r\nutils/db.py\r\n```python\r\nimport logging\r\nimport os\r\n\r\nfrom sqlalchemy.pool import QueuePool\r\nfrom sqlalchemy.sql import text\r\nfrom sqlmodel import SQLModel, Session, create_engine\r\nfrom sqlalchemy.exc import OperationalError\r\nfrom api.utils.scemgr import get_secret\r\n\r\nengine = None\r\nSECRET_NAME = os.environ.get('DB_SECRET_NAME')\r\nSQLALCHEMY_DATABASE_URL = 'postgresql+psycopg2://{username}:{password}@{host}:{port}/{dbname}'\r\n\r\n\r\ndef get_database_uri():\r\n    secret = get_secret(SECRET_NAME)\r\n    return SQLALCHEMY_DATABASE_URL.format(\r\n        username=secret['username'],\r\n        password=secret['password'],\r\n        host=secret['host'],\r\n        port=secret['port'],\r\n        dbname=secret['dbname'],\r\n    )\r\n\r\n\r\ndef get_engine():\r\n    global engine\r\n    if engine:\r\n        return engine\r\n    conn_str = get_database_uri()\r\n    engine = create_engine(\r\n        conn_str,\r\n        echo=True,\r\n        poolclass=QueuePool,\r\n        pool_pre_ping=True,\r\n        # pool_size=15,\r\n        # max_overflow=5,\r\n        echo_pool=\"debug\"\r\n    )\r\n    return engine\r\n\r\n\r\nengine = get_engine()\r\n\r\n\r\n#\r\n# class SessionManager:\r\n#     def __init__(self):\r\n#         self.db = sessionmaker(bind=engine, autocommit=True, expire_on_commit=False)\r\n#\r\n#     def __enter__(self):\r\n#         return self.db\r\n#\r\n#     def __exit__(self, exc_type, exc_val, exc_tb):\r\n#         self.db.close()\r\n\r\n\r\ndef get_session():\r\n    with Session(engine) as session:\r\n        try:\r\n            yield session\r\n            session.commit()\r\n        except Exception as exc:\r\n            session.rollback()\r\n            raise exc\r\n        finally:\r\n            session.close()\r\n\r\n\r\ndef init_db_sqlalchemy():\r\n    SQLModel.metadata.create_all(engine)\r\n\r\n\r\ndef fetch(db: Session, query, *args, **kwargs):\r\n    try:\r\n        stmt = text(query)\r\n        result = db.execute(stmt, *args, **kwargs)\r\n        db.commit()\r\n        return result\r\n    except (Exception, OperationalError) as err:\r\n        logging.exception(f\"error_code={err} function_name={fetch.__name__}\")\r\n    finally:\r\n        db.close()\r\n\r\n```\r\n\r\n```python\r\nimport os\r\nimport time\r\nfrom uuid import uuid4\r\n\r\nimport uvicorn\r\nfrom fastapi import FastAPI, Request, Depends\r\nfrom fastapi.encoders import jsonable_encoder\r\nfrom api.routes.info import info, health\r\nfrom api.utils.db import init_db_sqlalchemy, get_session, fetch\r\n\r\napp = FastAPI(\r\n)\r\napp.include_router(info, prefix=\"/info\")\r\napp.include_router(health, prefix=\"/health\")\r\n\r\n\r\n@app.middleware(\"http\")\r\nasync def add_logging_and_process_time(request: Request, call_next):\r\n    start_time = time.time()\r\n    request_id = str(uuid4().hex)\r\n    response = await call_next(request)\r\n    process_time = time.time() - start_time\r\n    process_time = str(round(process_time * 1000))\r\n    response.headers[\"X-Process-Time-MS\"] = process_time\r\n    log_msg = f\"request_id={request_id} service=my-svc url={request.url} host={request.client.host} \" \\\r\n              f\"port={request.client.port} processing_time_ms={process_time} env={os.environ.get('APP_ENV')} \" \\\r\n              f\"version=v1 pid={os.getpid()} region={os.environ.get('REGION')} \"\r\n    logger.info(log_msg)\r\n    return response\r\n\r\n@app.on_event('startup')\r\ndef startup():\r\n    init_db_sqlalchemy()\r\n\r\n@app.get('/getDatabaseInfo')\r\ndef get_db_data_example(db: Session = Depends(get_session)):\r\n    try:\r\n        records = fetch(db, DATABASE_QUERY).all()\r\n        return jsonable_encoder(records)\r\n    except Exception as err:\r\n        logger.exception(f\"function_name=getDatabaseInfo error={err}\")\r\n\r\n\r\n\r\nif __name__ == '__main__':\r\n    uvicorn.run(app, host=\"0.0.0.0\", port=8050)\r\n```\r\n\r\nI currently initialize the database on startup. In the event of a database connection error, where should we reinitialize the database? i.e. pull the new credentials from utils/secret_mgr.py and recreate the database engine in utils/db.py.\r\n\r\nGiven the above information a few questions:\r\n- Should engine be a global object if we need to reinit every 30 days?\r\n- If get_session fails, a dependency injection to the get request, fails it will close the session and add it back to the connection pool. If we are using a connection pool and one of the connections become invalidated, it will in turn invalidate all connections in the pool. This is okay, should happen. Where should we recreate the database engine? \r\n\r\nWhat is the proper way to do this given the constraints above?\r\n\r\n\r\n\r\n\r\n### Operating System\r\n\r\nLinux\r\n\r\n### Operating System Details\r\n\r\nDockerfile \r\n\r\nFROM python:3.8\r\n\r\nRUN microdnf install curl wget telnet vi bind-utils\r\n\r\nCOPY . /\r\nRUN pip3 install -r /requirements.txt\r\n\r\nUSER 99\r\nEXPOSE 8050\r\n\r\nCMD [\"python\", \"/api/main.py\"]\r\n\r\n### FastAPI Version\r\n\r\n0.74.0\r\n\r\n### Python Version\r\n\r\n3.8\r\n\r\n### Additional Context\r\n\r\nThank you for assistance on this question. I have searched but all documentation shows examples without anything impacting connection strings. Given that fastapi is the base for our backend, where should we initialize this task from a fastapi perspective?\r\n\r\n","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4741/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4741/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4740","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4740/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4740/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4740/events","html_url":"https://github.com/tiangolo/fastapi/issues/4740","id":1186608573,"node_id":"I_kwDOCZduT85GujW9","number":4740,"title":"Duplicated OperationID when adding route with multiple methods","user":{"login":"bruchar1","id":28656911,"node_id":"MDQ6VXNlcjI4NjU2OTEx","avatar_url":"https://avatars.githubusercontent.com/u/28656911?v=4","gravatar_id":"","url":"https://api.github.com/users/bruchar1","html_url":"https://github.com/bruchar1","followers_url":"https://api.github.com/users/bruchar1/followers","following_url":"https://api.github.com/users/bruchar1/following{/other_user}","gists_url":"https://api.github.com/users/bruchar1/gists{/gist_id}","starred_url":"https://api.github.com/users/bruchar1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bruchar1/subscriptions","organizations_url":"https://api.github.com/users/bruchar1/orgs","repos_url":"https://api.github.com/users/bruchar1/repos","events_url":"https://api.github.com/users/bruchar1/events{/privacy}","received_events_url":"https://api.github.com/users/bruchar1/received_events","type":"User","site_admin":false},"labels":[{"id":1154536363,"node_id":"MDU6TGFiZWwxMTU0NTM2MzYz","url":"https://api.github.com/repos/tiangolo/fastapi/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-03-30T15:10:50Z","updated_at":"2022-03-30T15:11:24Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### First Check\r\n\r\n- [X] I added a very descriptive title to this issue.\r\n- [X] I used the GitHub search to find a similar issue and didn't find it.\r\n- [X] I searched the FastAPI documentation, with the integrated search.\r\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n\r\n### Commit to Help\r\n\r\n- [X] I commit to help with one of those options 👆\r\n\r\n### Example Code\r\n\r\n```python\r\nrouter.add_api_route(\r\n    \"/clear\",\r\n    clear,\r\n    methods=[\"POST\", \"DELETE\"]\r\n)\r\n```\r\n\r\n\r\n### Description\r\n\r\nSeems to be caused by #4650.\r\n\r\nThe new `generate_unique_id()` function uses `list(route.methods)[0].lower()` as suffix for the `operation_id`. Therefore, in my example, both post and delete endpoints get `_post` suffix for operation_id, causing it to no longer be unique.\r\n\r\nIt then issues a \"UserWarning: Duplicate Operation ID\"\r\n\r\n### Operating System\r\n\r\nWindows\r\n\r\n### Operating System Details\r\n\r\n_No response_\r\n\r\n### FastAPI Version\r\n\r\n0.75.0\r\n\r\n### Python Version\r\n\r\n3.10.2\r\n\r\n### Additional Context\r\n\r\n_No response_","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4740/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4740/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4739","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4739/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4739/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4739/events","html_url":"https://github.com/tiangolo/fastapi/issues/4739","id":1186144475,"node_id":"I_kwDOCZduT85GsyDb","number":4739,"title":"GZip Middleware does not compress Streaming Response","user":{"login":"maramizo","id":7774220,"node_id":"MDQ6VXNlcjc3NzQyMjA=","avatar_url":"https://avatars.githubusercontent.com/u/7774220?v=4","gravatar_id":"","url":"https://api.github.com/users/maramizo","html_url":"https://github.com/maramizo","followers_url":"https://api.github.com/users/maramizo/followers","following_url":"https://api.github.com/users/maramizo/following{/other_user}","gists_url":"https://api.github.com/users/maramizo/gists{/gist_id}","starred_url":"https://api.github.com/users/maramizo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maramizo/subscriptions","organizations_url":"https://api.github.com/users/maramizo/orgs","repos_url":"https://api.github.com/users/maramizo/repos","events_url":"https://api.github.com/users/maramizo/events{/privacy}","received_events_url":"https://api.github.com/users/maramizo/received_events","type":"User","site_admin":false},"labels":[{"id":1154536363,"node_id":"MDU6TGFiZWwxMTU0NTM2MzYz","url":"https://api.github.com/repos/tiangolo/fastapi/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-03-30T09:17:15Z","updated_at":"2022-03-30T09:17:15Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### First Check\n\n- [X] I added a very descriptive title to this issue.\n- [X] I used the GitHub search to find a similar issue and didn't find it.\n- [X] I searched the FastAPI documentation, with the integrated search.\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\n\n### Commit to Help\n\n- [X] I commit to help with one of those options 👆\n\n### Example Code\n\n```python\nfrom fastapi.middleware.gzip import GZipMiddleware\r\nfrom starlette.middleware.cors import CORSMiddleware\r\n\r\n\r\napp = FastAPI()\r\napp.add_middleware(GZipMiddleware)\r\n\r\n\r\ncsv_file(path: str):\r\n    with open(path) as f:\r\n        yield f.readline()\r\n\r\n@app.get(\"/receivings\")\r\ndef receivings(start: str = start_date, end: str = now) -> StreamingResponse:\r\n    return StreamingResponse(csv_file(path), media_type='text/csv')\r\n\r\n\r\n\r\napp.add_middleware(\r\n    CORSMiddleware,\r\n    allow_origins=[\"https://www.website.com\"],\r\n    allow_methods=[\"POST\"],\r\n    allow_headers=[\"*\"]\r\n)\r\n\r\n\r\nif __name__ == '__main__':\r\n    uvicorn.run(\"middleserver:app\", host=\"0.0.0.0\", port=8080, log_level='trace')\n```\n\n\n### Description\n\n* Create a regular app with an endpoint that returns a StreamingResponse\r\n* Have GZip as a middleware\r\n* Result is not compressed even though it should be\r\n* Try again with FileResponse\r\n* Result is now compressed properly\n\n### Operating System\n\nWindows\n\n### Operating System Details\n\n_No response_\n\n### FastAPI Version\n\n0.75\n\n### Python Version\n\n3.10.3\n\n### Additional Context\n\n_No response_","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4739/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4739/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4737","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4737/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4737/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4737/events","html_url":"https://github.com/tiangolo/fastapi/issues/4737","id":1185476750,"node_id":"I_kwDOCZduT85GqPCO","number":4737,"title":"Eager loading with Pydantic model and SQLAlchemy?","user":{"login":"adityar15","id":44507591,"node_id":"MDQ6VXNlcjQ0NTA3NTkx","avatar_url":"https://avatars.githubusercontent.com/u/44507591?v=4","gravatar_id":"","url":"https://api.github.com/users/adityar15","html_url":"https://github.com/adityar15","followers_url":"https://api.github.com/users/adityar15/followers","following_url":"https://api.github.com/users/adityar15/following{/other_user}","gists_url":"https://api.github.com/users/adityar15/gists{/gist_id}","starred_url":"https://api.github.com/users/adityar15/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adityar15/subscriptions","organizations_url":"https://api.github.com/users/adityar15/orgs","repos_url":"https://api.github.com/users/adityar15/repos","events_url":"https://api.github.com/users/adityar15/events{/privacy}","received_events_url":"https://api.github.com/users/adityar15/received_events","type":"User","site_admin":false},"labels":[{"id":1154536363,"node_id":"MDU6TGFiZWwxMTU0NTM2MzYz","url":"https://api.github.com/repos/tiangolo/fastapi/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-03-29T22:08:22Z","updated_at":"2022-03-30T14:33:59Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### First Check\r\n\r\n- [X] I added a very descriptive title to this issue.\r\n- [X] I used the GitHub search to find a similar issue and didn't find it.\r\n- [X] I searched the FastAPI documentation, with the integrated search.\r\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n\r\n### Commit to Help\r\n\r\n- [X] I commit to help with one of those options 👆\r\n\r\n### Example Code\r\n\r\n```python\r\n#sqlalchemy models\r\n\r\nclass Seller(db.Base):\r\n    __tablename__= 'sellers'\r\n    id = Column(Integer, primary_key=True, index=True)\r\n    name = Column(String(100))\r\n    products = relationship(\"Product\", backref=\"seller\")\r\n\r\n\r\nclass Product(db.Base):\r\n    __tablename__= 'products'\r\n    id = Column(Integer, primary_key=True, index=True)\r\n    seller_id = Column(Integer, ForeignKey('sellers.id'))\r\n    name = Column(String(100))\r\n    attributes = relationship(\"Attribute\", backref=\"product\")\r\n\r\n\r\nclass Attribute(db.Base):\r\n    __tablename__ = 'attributes'\r\n    id = Column(Integer, primary_key=True, index=True)\r\n    product_id =  Column(Integer, ForeignKey('products.id'))\r\n    name = Column(String(255), unique=True, index=True, nullable=False)\r\n\r\n```\r\n\r\n\r\n### Description\r\n\r\nI am trying to eager load models in Fast API. Based on the example above I want to eager load seller data and go down the tree till attribute. How to eager load it? \r\n\r\n### Operating System\r\n\r\nWindows\r\n\r\n### Operating System Details\r\n\r\n_No response_\r\n\r\n### FastAPI Version\r\n\r\n0.65.1\r\n\r\n### Python Version\r\n\r\n3.8.7\r\n\r\n### Additional Context\r\n\r\n_No response_","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4737/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4737/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4736","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4736/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4736/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4736/events","html_url":"https://github.com/tiangolo/fastapi/pull/4736","id":1185233672,"node_id":"PR_kwDOCZduT841P8jp","number":4736,"title":":memo: Updates links for celery documentation","user":{"login":"sammyzord","id":23219524,"node_id":"MDQ6VXNlcjIzMjE5NTI0","avatar_url":"https://avatars.githubusercontent.com/u/23219524?v=4","gravatar_id":"","url":"https://api.github.com/users/sammyzord","html_url":"https://github.com/sammyzord","followers_url":"https://api.github.com/users/sammyzord/followers","following_url":"https://api.github.com/users/sammyzord/following{/other_user}","gists_url":"https://api.github.com/users/sammyzord/gists{/gist_id}","starred_url":"https://api.github.com/users/sammyzord/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sammyzord/subscriptions","organizations_url":"https://api.github.com/users/sammyzord/orgs","repos_url":"https://api.github.com/users/sammyzord/repos","events_url":"https://api.github.com/users/sammyzord/events{/privacy}","received_events_url":"https://api.github.com/users/sammyzord/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-03-29T18:07:27Z","updated_at":"2022-03-29T18:09:44Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/tiangolo/fastapi/pulls/4736","html_url":"https://github.com/tiangolo/fastapi/pull/4736","diff_url":"https://github.com/tiangolo/fastapi/pull/4736.diff","patch_url":"https://github.com/tiangolo/fastapi/pull/4736.patch","merged_at":null},"body":":memo: Updates the links to the celery documentation to the new domain.\r\n\r\nThe old domain has been compromised.  The DNS is now resolving to a Russian hosting company. \r\n\r\nSee https://github.com/celery/celeryproject/issues/52 for more information.","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4736/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4736/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4735","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4735/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4735/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4735/events","html_url":"https://github.com/tiangolo/fastapi/issues/4735","id":1184209323,"node_id":"I_kwDOCZduT85GlZmr","number":4735,"title":"Sentry ASG integration not working for FastAPI","user":{"login":"raminsj13","id":24259406,"node_id":"MDQ6VXNlcjI0MjU5NDA2","avatar_url":"https://avatars.githubusercontent.com/u/24259406?v=4","gravatar_id":"","url":"https://api.github.com/users/raminsj13","html_url":"https://github.com/raminsj13","followers_url":"https://api.github.com/users/raminsj13/followers","following_url":"https://api.github.com/users/raminsj13/following{/other_user}","gists_url":"https://api.github.com/users/raminsj13/gists{/gist_id}","starred_url":"https://api.github.com/users/raminsj13/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/raminsj13/subscriptions","organizations_url":"https://api.github.com/users/raminsj13/orgs","repos_url":"https://api.github.com/users/raminsj13/repos","events_url":"https://api.github.com/users/raminsj13/events{/privacy}","received_events_url":"https://api.github.com/users/raminsj13/received_events","type":"User","site_admin":false},"labels":[{"id":1154536363,"node_id":"MDU6TGFiZWwxMTU0NTM2MzYz","url":"https://api.github.com/repos/tiangolo/fastapi/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-03-29T02:23:14Z","updated_at":"2022-03-29T02:26:30Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"```python\r\nimport sentry_sdk\r\nfrom sentry_sdk.integrations.asgi import SentryAsgiMiddleware\r\nfrom core.app import app\r\nsentry_sdk.init(dsn=\"https://xxx.ingest.sentry.io/xxxx\")\r\nasgi_app = SentryAsgiMiddleware(app)\r\nraise ValueError()\r\n```\r\n\r\nand\r\n\r\n```python\r\napp = FastAPI()\r\nclass CustomSentryAsgiMiddleware(SentryAsgiMiddleware):\r\n    def event_processor(\r\n        self, event: \"Event\", hint: \"Hint\", asgi_scope: Any\r\n    ) -> \"Optional[Event]\":\r\n        result_event = super().event_processor(event, hint, asgi_scope)\r\n        route: Optional[APIRoute] = asgi_scope.get(\"route\")\r\n        if route and result_event:\r\n            result_event[\"transaction\"] = route.path\r\n        return result_event\r\n\r\napp.add_middleware(CustomSentryAsgiMiddleware)\r\nraise ValueError()\r\n```\r\n\r\n### Description\r\nUnable to make Sentry starter code send exceptions (not  HTTPExceptions) from FasAPI starter template. \r\n\r\nI followed instructions:\r\nhere: https://docs.sentry.io/platforms/python/guides/asgi/\r\n\r\nhere: https://fastapi.tiangolo.com/advanced/middleware/#httpsredirectmiddleware\r\n\r\nAnd traced related issues & latest contribution to Sentry's github: \r\nhttps://github.com/tiangolo/fastapi/pull/4603\r\nhttps://github.com/getsentry/sentry-python/pull/1349\r\n\r\nI can confirm that I was able to push errors using basic sentry as described here but this was a workaround from a while back: https://philstories.medium.com/integrate-sentry-to-fastapi-7250603c070f\r\n\r\nAny suggestions are appreciated.\r\n\r\nmacOS\r\nfastapi==0.75.0\r\nPython 3.9.10\r\nsentry-sdk==1.5.8","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4735/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4735/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4733","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4733/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4733/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4733/events","html_url":"https://github.com/tiangolo/fastapi/issues/4733","id":1183321226,"node_id":"I_kwDOCZduT85GiAyK","number":4733,"title":"How to pass and access the parameters inside middleware? Which passing technique to use, query parameter or path parameter? ","user":{"login":"pradeepdev-1995","id":41164884,"node_id":"MDQ6VXNlcjQxMTY0ODg0","avatar_url":"https://avatars.githubusercontent.com/u/41164884?v=4","gravatar_id":"","url":"https://api.github.com/users/pradeepdev-1995","html_url":"https://github.com/pradeepdev-1995","followers_url":"https://api.github.com/users/pradeepdev-1995/followers","following_url":"https://api.github.com/users/pradeepdev-1995/following{/other_user}","gists_url":"https://api.github.com/users/pradeepdev-1995/gists{/gist_id}","starred_url":"https://api.github.com/users/pradeepdev-1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pradeepdev-1995/subscriptions","organizations_url":"https://api.github.com/users/pradeepdev-1995/orgs","repos_url":"https://api.github.com/users/pradeepdev-1995/repos","events_url":"https://api.github.com/users/pradeepdev-1995/events{/privacy}","received_events_url":"https://api.github.com/users/pradeepdev-1995/received_events","type":"User","site_admin":false},"labels":[{"id":1154536363,"node_id":"MDU6TGFiZWwxMTU0NTM2MzYz","url":"https://api.github.com/repos/tiangolo/fastapi/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2022-03-28T11:50:58Z","updated_at":"2022-03-30T03:56:15Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### First Check\r\n\r\n- [X] I added a very descriptive title to this issue.\r\n- [X] I used the GitHub search to find a similar issue and didn't find it.\r\n- [X] I searched the FastAPI documentation, with the integrated search.\r\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n\r\n### Commit to Help\r\n\r\n- [x] I commit to help with one of those options 👆\r\n\r\n### Example Code\r\n\r\n```python\r\nfrom fastapi import FastAPI, Request\r\n\r\napp = FastAPI()\r\n\r\n@app.middleware(\"http\")\r\nasync def add_process_time_header(request: Request, call_next):\r\n    start_time = time.time()\r\n    response = await call_next(request)\r\n    process_time = time.time() - start_time\r\n    response.headers[\"X-Process-Time\"] = str(process_time)\r\n    return response\r\n```\r\n\r\n\r\n### Description\r\n\r\nAssume that, I Should pass one parameter(eg: query) to the middleware (add_process_time_header), How should  I pass the parameter, and how to access it inside the middleware?  \r\n\r\n### Operating System\r\n\r\nLinux\r\n\r\n### Operating System Details\r\n\r\n_No response_\r\n\r\n### FastAPI Version\r\n\r\nFlask-API==2.0\r\n\r\n### Python Version\r\n\r\n3.6.9\r\n\r\n### Additional Context\r\n\r\n_No response_","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4733/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4733/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4730","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4730/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4730/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4730/events","html_url":"https://github.com/tiangolo/fastapi/issues/4730","id":1181926218,"node_id":"I_kwDOCZduT85GcsNK","number":4730,"title":"creating a conditional authentication dependency","user":{"login":"havok2063","id":1836302,"node_id":"MDQ6VXNlcjE4MzYzMDI=","avatar_url":"https://avatars.githubusercontent.com/u/1836302?v=4","gravatar_id":"","url":"https://api.github.com/users/havok2063","html_url":"https://github.com/havok2063","followers_url":"https://api.github.com/users/havok2063/followers","following_url":"https://api.github.com/users/havok2063/following{/other_user}","gists_url":"https://api.github.com/users/havok2063/gists{/gist_id}","starred_url":"https://api.github.com/users/havok2063/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/havok2063/subscriptions","organizations_url":"https://api.github.com/users/havok2063/orgs","repos_url":"https://api.github.com/users/havok2063/repos","events_url":"https://api.github.com/users/havok2063/events{/privacy}","received_events_url":"https://api.github.com/users/havok2063/received_events","type":"User","site_admin":false},"labels":[{"id":1154536363,"node_id":"MDU6TGFiZWwxMTU0NTM2MzYz","url":"https://api.github.com/repos/tiangolo/fastapi/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-03-26T17:28:41Z","updated_at":"2022-03-29T15:51:28Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### First Check\r\n\r\n- [X] I added a very descriptive title to this issue.\r\n- [X] I used the GitHub search to find a similar issue and didn't find it.\r\n- [X] I searched the FastAPI documentation, with the integrated search.\r\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n\r\n### Commit to Help\r\n\r\n- [X] I commit to help with one of those options 👆\r\n\r\n### Example Code\r\n\r\n```python\r\nfrom fastapi import FastAPI, Depends, Request\r\nfrom fastapi.security import OAuth2PasswordBearer, OAuth2PasswordRequestForm\r\n\r\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"login\")\r\n\r\nasync def release(release: str = 'A') -> str:\r\n    \"\"\" Dependency to specify a release query parameter \"\"\"\r\n    return release\r\n\r\nasync def check_auth(request: Request, release = Depends(release)):\r\n    release = release or 'A'\r\n    if release != 'A':\r\n        return None\r\n    return await oauth2_scheme(request)\r\n\r\nasync def set_auth(token: str = Depends(check_auth), release = Depends(release)): \r\n    return {\"token\": token, 'release': release}\r\n\r\napp = FastAPI(title='API', description='The API', dependencies=[Depends(set_auth)])\r\n\r\n@app.get(\"/\", summary='Hello World route')\r\ndef hello(release = Depends(release)):\r\n    return {\"Hello\": \"Hello World\", 'release': release}\r\n\r\n@app.post(\"/login\")\r\nasync def login(form_data: OAuth2PasswordRequestForm = Depends()):\r\n    # standard normal login stuff\r\n    # ...\r\n    return {\"access_token\": 'blah', \"token_type\": \"bearer\"}\r\n```\r\n\r\n\r\n### Description\r\n\r\nI'm trying to create an API with a conditional authentication system.  This API will serve data bundled into releases, e.g. A, B, C.   Releases B, C are public and A is proprietary.  All the API routes should work for all the data, but data from release A needs to be behind authentication.  Routes should work without an auth prompt for all releases not from A.  I've created a standard OAuth2PasswordBearer system and wrapped it inside a `check_auth` dependency.  The example code provided works.  I can do\r\n\r\n```\r\nrequests.get('http://localhost:8000/?release=B').json()\r\n{\"Hello\": \"Hello World\", 'release': 'B'}\r\n\r\nrequests.get('http://localhost:8000/?release=A').json()\r\n{'detail': 'Not authenticated'}\r\n```\r\nbut the use of `await oauth2_scheme(request)` doesn't feel very FastAPI-ish to me.  My question is does this solution make sense, or is there a better way, more in-align with best practices for FastAPI?  Also, it looks like the Authorize option in my rendered documentation (`localhost:8000/docs`) is gone.  Is there a way to get that to appear with this implementation?\r\n\r\n\r\n### Operating System\r\n\r\nmacOS\r\n\r\n### Operating System Details\r\n\r\n_No response_\r\n\r\n### FastAPI Version\r\n\r\n0.74.1\r\n\r\n### Python Version\r\n\r\n3.8\r\n\r\n### Additional Context\r\n\r\n_No response_","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4730/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4730/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4729","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4729/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4729/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4729/events","html_url":"https://github.com/tiangolo/fastapi/pull/4729","id":1181888745,"node_id":"PR_kwDOCZduT841E1Bl","number":4729,"title":"🌐 Fixed a bug that occurred when running live server for docs in some languages.","user":{"login":"wakabame","id":35513518,"node_id":"MDQ6VXNlcjM1NTEzNTE4","avatar_url":"https://avatars.githubusercontent.com/u/35513518?v=4","gravatar_id":"","url":"https://api.github.com/users/wakabame","html_url":"https://github.com/wakabame","followers_url":"https://api.github.com/users/wakabame/followers","following_url":"https://api.github.com/users/wakabame/following{/other_user}","gists_url":"https://api.github.com/users/wakabame/gists{/gist_id}","starred_url":"https://api.github.com/users/wakabame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wakabame/subscriptions","organizations_url":"https://api.github.com/users/wakabame/orgs","repos_url":"https://api.github.com/users/wakabame/repos","events_url":"https://api.github.com/users/wakabame/events{/privacy}","received_events_url":"https://api.github.com/users/wakabame/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-03-26T16:35:44Z","updated_at":"2022-03-26T16:35:44Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/tiangolo/fastapi/pulls/4729","html_url":"https://github.com/tiangolo/fastapi/pull/4729","diff_url":"https://github.com/tiangolo/fastapi/pull/4729.diff","patch_url":"https://github.com/tiangolo/fastapi/pull/4729.patch","merged_at":null},"body":"Docs for tests fail in some languages due to undefined 'sponsors' (`fr`, `ja`, `zh`) or no `docs/` in dir(`az`):\r\n\r\n<details><summary> `python ./scripts/docs.py live ja` </summary>\r\n\r\n```\r\n$ python ./scripts/docs.py live ja\r\nERROR:mkdocs.commands.build:Error reading page 'fastapi-people.md': 'sponsors' is undefined\r\nTraceback (most recent call last):\r\n  File \"./scripts/docs.py\", line 449, in <module>\r\n    app()\r\n  File \"/home/wakabame/fastapi/env/lib/python3.8/site-packages/typer/main.py\", line 214, in __call__\r\n    return get_command(self)(*args, **kwargs)\r\n  File \"/home/wakabame/fastapi/env/lib/python3.8/site-packages/click/core.py\", line 829, in __call__\r\n    return self.main(*args, **kwargs)\r\n  File \"/home/wakabame/fastapi/env/lib/python3.8/site-packages/click/core.py\", line 782, in main\r\n    rv = self.invoke(ctx)\r\n  File \"/home/wakabame/fastapi/env/lib/python3.8/site-packages/click/core.py\", line 1259, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n  File \"/home/wakabame/fastapi/env/lib/python3.8/site-packages/click/core.py\", line 1066, in invoke\r\n    return ctx.invoke(self.callback, **ctx.params)\r\n  File \"/home/wakabame/fastapi/env/lib/python3.8/site-packages/click/core.py\", line 610, in invoke\r\n    return callback(*args, **kwargs)\r\n  File \"/home/wakabame/fastapi/env/lib/python3.8/site-packages/typer/main.py\", line 497, in wrapper\r\n    return callback(**use_params)  # type: ignore\r\n  File \"./scripts/docs.py\", line 357, in live\r\n    mkdocs.commands.serve.serve(dev_addr=\"127.0.0.1:8008\")\r\n  File \"/home/wakabame/fastapi/env/lib/python3.8/site-packages/mkdocs/commands/serve.py\", line 54, in serve\r\n    config = builder()\r\n  File \"/home/wakabame/fastapi/env/lib/python3.8/site-packages/mkdocs/commands/serve.py\", line 49, in builder\r\n    build(config, live_server=live_server, dirty=dirty)\r\n  File \"/home/wakabame/fastapi/env/lib/python3.8/site-packages/mkdocs/commands/build.py\", line 292, in build\r\n    _populate_page(file.page, config, files, dirty)\r\n  File \"/home/wakabame/fastapi/env/lib/python3.8/site-packages/mkdocs/commands/build.py\", line 170, in _populate_page\r\n    page.markdown = config['plugins'].run_event(\r\n  File \"/home/wakabame/fastapi/env/lib/python3.8/site-packages/mkdocs/plugins.py\", line 102, in run_event\r\n    result = method(item, **kwargs)\r\n  File \"/home/wakabame/fastapi/env/lib/python3.8/site-packages/markdownextradata/plugin.py\", line 99, in on_page_markdown\r\n    return self.apply_template(markdown)\r\n  File \"/home/wakabame/fastapi/env/lib/python3.8/site-packages/markdownextradata/plugin.py\", line 111, in apply_template\r\n    return md_template.render({**self.mkdocsConfig, **self.mkdocsConfig.get(\"extra\")})\r\n  File \"/home/wakabame/fastapi/env/lib/python3.8/site-packages/jinja2/environment.py\", line 1291, in render\r\n    self.environment.handle_exception()\r\n  File \"/home/wakabame/fastapi/env/lib/python3.8/site-packages/jinja2/environment.py\", line 925, in handle_exception\r\n    raise rewrite_traceback_stack(source=source)\r\n  File \"<template>\", line 118, in top-level template code\r\n  File \"/home/wakabame/fastapi/env/lib/python3.8/site-packages/jinja2/environment.py\", line 474, in getattr\r\n    return getattr(obj, attribute)\r\njinja2.exceptions.UndefinedError: 'sponsors' is undefined\r\n```\r\n\r\n</details>\r\n\r\n<details><summary> `python ./scripts/docs.py live az` </summary>\r\n\r\n```\r\n$ python ./scripts/docs.py live az\r\nERROR:mkdocs.config:Config value: 'docs_dir'. Error: The path /home/wakabame/fastapi/docs/az/docs isn't an existing directory.\r\nAborted with 1 Configuration Errors!\r\n```\r\n\r\n</details>\r\n\r\n- Since the sponsor is not defined in the development environment, we need check `{% if sponsors %}` before `{% if sponsors.gold %}`.\r\n- In `docs/az/docs`, temporarily create `.gitkeep` to make the directory aware","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4729/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4729/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4727","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4727/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4727/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4727/events","html_url":"https://github.com/tiangolo/fastapi/pull/4727","id":1181352424,"node_id":"PR_kwDOCZduT841C_n0","number":4727,"title":"✨ Merge openapi descriptions for routes with same path and method.","user":{"login":"plankthom","id":1620679,"node_id":"MDQ6VXNlcjE2MjA2Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/1620679?v=4","gravatar_id":"","url":"https://api.github.com/users/plankthom","html_url":"https://github.com/plankthom","followers_url":"https://api.github.com/users/plankthom/followers","following_url":"https://api.github.com/users/plankthom/following{/other_user}","gists_url":"https://api.github.com/users/plankthom/gists{/gist_id}","starred_url":"https://api.github.com/users/plankthom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/plankthom/subscriptions","organizations_url":"https://api.github.com/users/plankthom/orgs","repos_url":"https://api.github.com/users/plankthom/repos","events_url":"https://api.github.com/users/plankthom/events{/privacy}","received_events_url":"https://api.github.com/users/plankthom/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2022-03-25T23:19:14Z","updated_at":"2022-03-29T13:21:16Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/tiangolo/fastapi/pulls/4727","html_url":"https://github.com/tiangolo/fastapi/pull/4727","diff_url":"https://github.com/tiangolo/fastapi/pull/4727.diff","patch_url":"https://github.com/tiangolo/fastapi/pull/4727.patch","merged_at":null},"body":"This feature allows merging the open-api specification for routes\r\nwith the same path and method.\r\nThe primary motivation was to allow separate route definitions\r\nper response content (routed on the Accept header), resulting in separate sections per accepted mediatype in the openapi.json at\r\n> `paths.<path>.<method>.responses.<status_code>.content.<media-type>`\r\n\r\nSee #4694 and #3910","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4727/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4727/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4726","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4726/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4726/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4726/events","html_url":"https://github.com/tiangolo/fastapi/pull/4726","id":1181017728,"node_id":"PR_kwDOCZduT841B30D","number":4726,"title":"Fixed a minor grammar mistake in the docs for async.","user":{"login":"Prezu","id":58888,"node_id":"MDQ6VXNlcjU4ODg4","avatar_url":"https://avatars.githubusercontent.com/u/58888?v=4","gravatar_id":"","url":"https://api.github.com/users/Prezu","html_url":"https://github.com/Prezu","followers_url":"https://api.github.com/users/Prezu/followers","following_url":"https://api.github.com/users/Prezu/following{/other_user}","gists_url":"https://api.github.com/users/Prezu/gists{/gist_id}","starred_url":"https://api.github.com/users/Prezu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Prezu/subscriptions","organizations_url":"https://api.github.com/users/Prezu/orgs","repos_url":"https://api.github.com/users/Prezu/repos","events_url":"https://api.github.com/users/Prezu/events{/privacy}","received_events_url":"https://api.github.com/users/Prezu/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-03-25T16:49:41Z","updated_at":"2022-03-25T16:49:41Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/tiangolo/fastapi/pulls/4726","html_url":"https://github.com/tiangolo/fastapi/pull/4726","diff_url":"https://github.com/tiangolo/fastapi/pull/4726.diff","patch_url":"https://github.com/tiangolo/fastapi/pull/4726.patch","merged_at":null},"body":"In the docs about [async](https://fastapi.tiangolo.com/async/) I've spotted minor grammar mistake:\r\n\r\nsit **on** the table :arrow_right:  sit **at** the table.","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4726/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4726/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4725","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4725/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4725/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4725/events","html_url":"https://github.com/tiangolo/fastapi/pull/4725","id":1180781112,"node_id":"PR_kwDOCZduT841BF1Y","number":4725,"title":"Workaround to fix Pyright/Pydantic missing parameters issue","user":{"login":"jtv8","id":29302451,"node_id":"MDQ6VXNlcjI5MzAyNDUx","avatar_url":"https://avatars.githubusercontent.com/u/29302451?v=4","gravatar_id":"","url":"https://api.github.com/users/jtv8","html_url":"https://github.com/jtv8","followers_url":"https://api.github.com/users/jtv8/followers","following_url":"https://api.github.com/users/jtv8/following{/other_user}","gists_url":"https://api.github.com/users/jtv8/gists{/gist_id}","starred_url":"https://api.github.com/users/jtv8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtv8/subscriptions","organizations_url":"https://api.github.com/users/jtv8/orgs","repos_url":"https://api.github.com/users/jtv8/repos","events_url":"https://api.github.com/users/jtv8/events{/privacy}","received_events_url":"https://api.github.com/users/jtv8/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-03-25T13:14:21Z","updated_at":"2022-03-25T13:14:21Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/tiangolo/fastapi/pulls/4725","html_url":"https://github.com/tiangolo/fastapi/pull/4725","diff_url":"https://github.com/tiangolo/fastapi/pull/4725.diff","patch_url":"https://github.com/tiangolo/fastapi/pull/4725.patch","merged_at":null},"body":"Users of Pyright, or the Pylance extension in Visual Studio Code, may have noticed that when type checking is activated certain models in `fastapi.openapi.models` complain about missing parameters that are actually optional.\r\n\r\nMost notably, the `Schema` object cannot be created programmatically without a type checking error as Pyright/Pylance believes that it is missing an required keyword argument, `$ref`, that cannot be legally provided in Python.\r\n\r\n> `Arguments missing for parameters \"$ref\", ...`\r\n\r\nThis is due to a known compatibility issue with a workaround that is documented here:\r\nhttps://github.com/samuelcolvin/pydantic/issues/3753\r\n\r\nThis PR implements that workaround for the models in `fastapi.openapi.models`.","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4725/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4725/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4722","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4722/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4722/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4722/events","html_url":"https://github.com/tiangolo/fastapi/pull/4722","id":1180308100,"node_id":"PR_kwDOCZduT840_hwv","number":4722,"title":"typo: docs","user":{"login":"CleoMenezesJr","id":54215258,"node_id":"MDQ6VXNlcjU0MjE1MjU4","avatar_url":"https://avatars.githubusercontent.com/u/54215258?v=4","gravatar_id":"","url":"https://api.github.com/users/CleoMenezesJr","html_url":"https://github.com/CleoMenezesJr","followers_url":"https://api.github.com/users/CleoMenezesJr/followers","following_url":"https://api.github.com/users/CleoMenezesJr/following{/other_user}","gists_url":"https://api.github.com/users/CleoMenezesJr/gists{/gist_id}","starred_url":"https://api.github.com/users/CleoMenezesJr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CleoMenezesJr/subscriptions","organizations_url":"https://api.github.com/users/CleoMenezesJr/orgs","repos_url":"https://api.github.com/users/CleoMenezesJr/repos","events_url":"https://api.github.com/users/CleoMenezesJr/events{/privacy}","received_events_url":"https://api.github.com/users/CleoMenezesJr/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-03-25T03:48:54Z","updated_at":"2022-03-25T03:48:54Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/tiangolo/fastapi/pulls/4722","html_url":"https://github.com/tiangolo/fastapi/pull/4722","diff_url":"https://github.com/tiangolo/fastapi/pull/4722.diff","patch_url":"https://github.com/tiangolo/fastapi/pull/4722.patch","merged_at":null},"body":null,"reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4722/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4722/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4721","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4721/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4721/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4721/events","html_url":"https://github.com/tiangolo/fastapi/issues/4721","id":1179665605,"node_id":"I_kwDOCZduT85GUETF","number":4721,"title":"Python - FastAPI - Optional option for an UploadFile","user":{"login":"LidorPrototype","id":58004244,"node_id":"MDQ6VXNlcjU4MDA0MjQ0","avatar_url":"https://avatars.githubusercontent.com/u/58004244?v=4","gravatar_id":"","url":"https://api.github.com/users/LidorPrototype","html_url":"https://github.com/LidorPrototype","followers_url":"https://api.github.com/users/LidorPrototype/followers","following_url":"https://api.github.com/users/LidorPrototype/following{/other_user}","gists_url":"https://api.github.com/users/LidorPrototype/gists{/gist_id}","starred_url":"https://api.github.com/users/LidorPrototype/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LidorPrototype/subscriptions","organizations_url":"https://api.github.com/users/LidorPrototype/orgs","repos_url":"https://api.github.com/users/LidorPrototype/repos","events_url":"https://api.github.com/users/LidorPrototype/events{/privacy}","received_events_url":"https://api.github.com/users/LidorPrototype/received_events","type":"User","site_admin":false},"labels":[{"id":1154536363,"node_id":"MDU6TGFiZWwxMTU0NTM2MzYz","url":"https://api.github.com/repos/tiangolo/fastapi/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":22,"created_at":"2022-03-24T15:18:51Z","updated_at":"2022-03-31T07:09:05Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### First Check\r\n\r\n- [x] I added a very descriptive title to this issue.\r\n- [X] I used the GitHub search to find a similar issue and didn't find it.\r\n- [X] I searched the FastAPI documentation, with the integrated search.\r\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n\r\n### Commit to Help\r\n\r\n- [X] I commit to help with one of those options 👆\r\n\r\n### Example Code\r\n\r\n```python\r\nfrom typing import Optional\r\nfrom fastapi import FastAPI, UploadFile, File\r\n\r\napp = FastAPI()\r\n\r\n@app.get(\"/\")\r\ndef root():\r\n    pass\r\n\r\n@app.post(\"/OptionOne\")\r\ndef pdf_foo1(file: Optional[UploadFile] = None):\r\n    print(file.filename)\r\n\r\n@app.post(\"/OptionTwo\")\r\ndef pdf_foo2(file: Optional[UploadFile] = File(None)):\r\n    print(file.filename)\r\n\r\n@app.post(\"/OptionThree\")\r\ndef pdf_foo3(file: UploadFile = File(None)):\r\n    print(file.filename)\r\n\r\n@app.post(\"/OptionFour\")\r\ndef pdf_foo4(file: UploadFile = None):\r\n    print(file.filename)\r\n\r\n@app.post(\"/OptionFive\")\r\ndef pdf_foo5(file: bytes = File(None)):\r\n    print(file)\r\n```\r\n\r\n\r\n### Description\r\n\r\n### Short Summary\r\nI am trying to do what I think is a simple thing but no internet solution has helped me so far, and I didn't find anything helpful yet in the issues.\r\n___\r\n### The desired solution:\r\nA route (function) that will accept an UploadFile but that will be optional, the user will not be have to provide it.\r\n\r\n### Current Case:\r\nIn the code there are 5 different cases I tried, all of them are not working as follows:\r\nCases 1, 3 Gives an 'ValueError: Value not declarable with JSON Schema'\r\nCases 2, 4 Acts like it's not always must:\r\n - It will boot up and start working, but when I try to send a request (for example in the docs swagger) it will gives me a 422 error and will say it excepts data named \"file\" (in this case)\r\nCase 5 Gives a different error (up until now I saw 3 different ones) but anyway using bytes is not the solution I'm looking for.\r\n\r\n### Operating System\r\n\r\nLinux, Windows\r\n\r\n### Operating System Details\r\n\r\nIm developing on a windows server, and publish on a Linux webapp (Azure)\r\n\r\n### FastAPI Version\r\n\r\n0.70.1\r\n\r\n### Python Version\r\n\r\n3.8.2\r\n\r\n### Additional Context\r\n\r\nI'm testing it with Swagger (Locally and Webapp) and also using the API links in a different program\r\n( If I missed anything, or there is anything else you need to know in order to resolve this issue, please comment and I will update the data accordingly within 12 hours max [Not including Friday and Saturday] )","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4721/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4721/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4719","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4719/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4719/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4719/events","html_url":"https://github.com/tiangolo/fastapi/issues/4719","id":1179619862,"node_id":"I_kwDOCZduT85GT5IW","number":4719,"title":"Problems with await in async dependencies (when using dependencies and middleware simultaneously)","user":{"login":"Rashid567","id":57359170,"node_id":"MDQ6VXNlcjU3MzU5MTcw","avatar_url":"https://avatars.githubusercontent.com/u/57359170?v=4","gravatar_id":"","url":"https://api.github.com/users/Rashid567","html_url":"https://github.com/Rashid567","followers_url":"https://api.github.com/users/Rashid567/followers","following_url":"https://api.github.com/users/Rashid567/following{/other_user}","gists_url":"https://api.github.com/users/Rashid567/gists{/gist_id}","starred_url":"https://api.github.com/users/Rashid567/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rashid567/subscriptions","organizations_url":"https://api.github.com/users/Rashid567/orgs","repos_url":"https://api.github.com/users/Rashid567/repos","events_url":"https://api.github.com/users/Rashid567/events{/privacy}","received_events_url":"https://api.github.com/users/Rashid567/received_events","type":"User","site_admin":false},"labels":[{"id":1154536363,"node_id":"MDU6TGFiZWwxMTU0NTM2MzYz","url":"https://api.github.com/repos/tiangolo/fastapi/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-03-24T14:44:40Z","updated_at":"2022-03-30T09:45:06Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### First Check\n\n- [X] I added a very descriptive title to this issue.\n- [X] I used the GitHub search to find a similar issue and didn't find it.\n- [X] I searched the FastAPI documentation, with the integrated search.\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\n\n### Commit to Help\n\n- [X] I commit to help with one of those options 👆\n\n### Example Code\n\n```python\nimport fastapi\r\nimport datetime as dt\r\nimport sqlalchemy as sa\r\n\r\nfrom sqlalchemy.ext.asyncio import AsyncEngine, AsyncSession\r\nfrom sqlalchemy.ext.asyncio import create_async_engine\r\nfrom sqlalchemy.orm import sessionmaker\r\n\r\n\r\nclass _Conn:\r\n    radius_engine: AsyncEngine\r\n    radius_session_maker: sessionmaker\r\n\r\n\r\ndef init_pg_connections() -> None:\r\n    _Conn.radius_engine = create_async_engine(\r\n        'postgresql+asyncpg://postgres:password@host:port/db_name',\r\n        connect_args={\r\n            'server_settings': {\r\n                'application_name': 'test_app'\r\n            }\r\n        },\r\n        pool_size=2, max_overflow=10\r\n    )\r\n    _Conn.radius_session_maker = sessionmaker(\r\n        bind=_Conn.radius_engine,\r\n        autoflush=False, autocommit=False,\r\n        expire_on_commit=False,\r\n        class_=AsyncSession\r\n    )\r\n\r\n\r\nasync def get_db():\r\n    db: AsyncSession = _Conn.radius_session_maker()\r\n    try:\r\n        yield db\r\n    finally:\r\n        print('finally get_db. Before close')\r\n        await db.close()\r\n        print('finally get_db. After close')\r\n\r\n\r\ndef get_app():\r\n    app = fastapi.FastAPI(\r\n        on_startup=[init_pg_connections]\r\n    )\r\n\r\n    @app.middleware('http')\r\n    async def add_process_time_header(request: fastapi.Request, call_next):\r\n        start_time = dt.datetime.now()\r\n        response = await call_next(request)\r\n        process_time = (dt.datetime.now() - start_time).total_seconds()\r\n        response.headers[\"X-Process-Time\"] = str(process_time)\r\n        return response\r\n\r\n    @app.post('/test')\r\n    async def test(\r\n            data: int = fastapi.Body(5, embed=True),\r\n            db: AsyncSession = fastapi.Depends(get_db)\r\n    ):\r\n        res = (await db.execute(sa.text('Select * FROM radacct'))).scalars().all()\r\n        print('test', f'{data=} {res=}')\r\n        return 'OK'\r\n    return app\r\n\r\n\r\nif __name__ == '__main__':\r\n    import uvicorn\r\n    _app = get_app()\r\n    uvicorn.run(_app, host='10.10.10.98', port=7776)\n```\n\n\n### Description\n\nFastAPI version>=0.74 has a very strange problem with dependency (func get_db in example). \r\n\r\n1) If you run this code as it is and send request from swagger every thing is ok (Connection with db will close and you see message 'finally get_db. After close' in console).\r\n\r\n2) If you run this code as it is and use curl or aiohttp to send request, then \"await db.close()\" is never finish and you will not see message 'finally get_db. After close' in console. And if you continue to send requests, then you get warnings from Garbage collector and SQLAlchemy:\r\n\r\n`The garbage collector is trying to clean up connection <AdaptedConnection <asyncpg.connection.Connection object at 0x7fd3626a4740>>. This feature is unsupported on async dbapi, since no IO can be performed at this stage to reset the connection. Please close out all connections when they are no longer used, calling \"close()\" or using a context manager to manage their lifetime.`\r\n\r\n`/usr/lib/python3.10/ipaddress.py:45: SAWarning: The garbage collector is trying to clean up connection <AdaptedConnection <asyncpg.connection.Connection object at 0x7fd3626a4740>>. This feature is unsupported on async dbapi, since no IO can be performed at this stage to reset the connection. Please close out all connections when they are no longer used, calling \"close()\" or using a context manager to manage their lifetime.`\r\n\r\n`return IPv4Address(address)`\r\n\r\n3) If you comment middleware and send requests from any client (swagger, curl and aiohttp), then every thing is ok.\r\n\r\n4) If you run this code as it is with FastAPI version <= 0.73, then every thing is ok.\r\n\r\nIn each cases clients has no problems in getting 200 responses from server.\r\nUnfortunately i have no idea why this happening.\r\n\r\nRequirements:\r\nanyio==3.5.0\r\nasgiref==3.5.0\r\nasyncpg==0.25.0\r\nclick==8.0.4\r\ncoloredlogs==15.0.1\r\nfastapi==0.75.0 | 0.73.0\r\ngreenlet==1.1.2\r\nh11==0.13.0\r\nhttptools==0.3.0\r\nhumanfriendly==10.0\r\nidna==3.3\r\nmypy==0.931\r\nmypy-extensions==0.4.3\r\npydantic==1.9.0\r\npython-dateutil==2.8.2\r\npython-dotenv==0.19.2\r\nPyYAML==6.0\r\nsix==1.16.0\r\nsniffio==1.2.0\r\nSQLAlchemy==1.4.32\r\nsqlalchemy2-stubs==0.0.2a20\r\nstarlette==0.17.1\r\ntomli==2.0.1\r\ntyping_extensions==4.1.1\r\nuvicorn==0.17.5\r\nuvloop==0.16.0\r\nwatchgod==0.7\r\nwebsockets==10.2\r\n\n\n### Operating System\n\nLinux\n\n### Operating System Details\n\n_No response_\n\n### FastAPI Version\n\n>=0.74\n\n### Python Version\n\n3.9 and 3.10\n\n### Additional Context\n\n_No response_","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4719/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4719/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4718","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4718/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4718/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4718/events","html_url":"https://github.com/tiangolo/fastapi/issues/4718","id":1178430280,"node_id":"I_kwDOCZduT85GPWtI","number":4718,"title":"Response model with default value of empty list not showing in docs","user":{"login":"jordantshaw","id":33508069,"node_id":"MDQ6VXNlcjMzNTA4MDY5","avatar_url":"https://avatars.githubusercontent.com/u/33508069?v=4","gravatar_id":"","url":"https://api.github.com/users/jordantshaw","html_url":"https://github.com/jordantshaw","followers_url":"https://api.github.com/users/jordantshaw/followers","following_url":"https://api.github.com/users/jordantshaw/following{/other_user}","gists_url":"https://api.github.com/users/jordantshaw/gists{/gist_id}","starred_url":"https://api.github.com/users/jordantshaw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jordantshaw/subscriptions","organizations_url":"https://api.github.com/users/jordantshaw/orgs","repos_url":"https://api.github.com/users/jordantshaw/repos","events_url":"https://api.github.com/users/jordantshaw/events{/privacy}","received_events_url":"https://api.github.com/users/jordantshaw/received_events","type":"User","site_admin":false},"labels":[{"id":1154536363,"node_id":"MDU6TGFiZWwxMTU0NTM2MzYz","url":"https://api.github.com/repos/tiangolo/fastapi/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-03-23T17:25:32Z","updated_at":"2022-03-23T17:25:32Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### First Check\n\n- [X] I added a very descriptive title to this issue.\n- [X] I used the GitHub search to find a similar issue and didn't find it.\n- [X] I searched the FastAPI documentation, with the integrated search.\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\n\n### Commit to Help\n\n- [X] I commit to help with one of those options 👆\n\n### Example Code\n\n```python\nclass User(BaseModel):\r\n    username: str = None\r\n\r\nclass UserResponse(BaseModel):\r\n    data: List[User] = []\r\n    metadata: Dict\n```\n\n\n### Description\n\nI am having an issue with the docs displaying the response models sub models correctly when an empty list is the default value. I would expect the docs to display the array and the sub-model inside the array, but instead the docs just show an empty array.  If I set the default value to None, it displays as I would expect.  This happens on both redoc and swagger.\r\n\r\nAny ideas on a workaround or on how to solve this issue?\r\n\r\nThis is how the docs appear with when an empty array is used as default value.\r\n![image](https://user-images.githubusercontent.com/33508069/159758477-45b14afa-b575-4753-bca5-3668b24639d7.png)\r\n\r\nThis is how the docs appear when setting the default value to None (This is what I want the docs to look like).\r\n![image](https://user-images.githubusercontent.com/33508069/159758884-bc498eec-1dfd-458c-a332-6685a1307749.png)\r\n\n\n### Operating System\n\nmacOS\n\n### Operating System Details\n\n_No response_\n\n### FastAPI Version\n\n0.75.0\n\n### Python Version\n\nPython 3.9.10\n\n### Additional Context\n\n_No response_","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4718/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4718/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4716","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4716/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4716/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4716/events","html_url":"https://github.com/tiangolo/fastapi/issues/4716","id":1177677924,"node_id":"I_kwDOCZduT85GMfBk","number":4716,"title":"Foreign key relational data to include certain rows only (like deleted_at==None) not all rows","user":{"login":"ksthakur","id":18477844,"node_id":"MDQ6VXNlcjE4NDc3ODQ0","avatar_url":"https://avatars.githubusercontent.com/u/18477844?v=4","gravatar_id":"","url":"https://api.github.com/users/ksthakur","html_url":"https://github.com/ksthakur","followers_url":"https://api.github.com/users/ksthakur/followers","following_url":"https://api.github.com/users/ksthakur/following{/other_user}","gists_url":"https://api.github.com/users/ksthakur/gists{/gist_id}","starred_url":"https://api.github.com/users/ksthakur/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ksthakur/subscriptions","organizations_url":"https://api.github.com/users/ksthakur/orgs","repos_url":"https://api.github.com/users/ksthakur/repos","events_url":"https://api.github.com/users/ksthakur/events{/privacy}","received_events_url":"https://api.github.com/users/ksthakur/received_events","type":"User","site_admin":false},"labels":[{"id":1154536363,"node_id":"MDU6TGFiZWwxMTU0NTM2MzYz","url":"https://api.github.com/repos/tiangolo/fastapi/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-03-23T06:51:52Z","updated_at":"2022-03-23T10:43:47Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### First Check\r\n\r\n- [X] I added a very descriptive title to this issue.\r\n- [X] I used the GitHub search to find a similar issue and didn't find it.\r\n- [X] I searched the FastAPI documentation, with the integrated search.\r\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n- [x] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n- [x] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n- [x] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n\r\n### Commit to Help\r\n\r\n- [X] I commit to help with one of those options 👆\r\n\r\n### Example Code\r\n\r\n```python\r\nclass InvoiceItemSchema(BaseModel):\r\n    id: int\r\n    invoice_id: int\r\n    item_name: str\r\n    item_description: str\r\n    cost: float\r\n    quantity: int\r\n    price: float\r\n    deleted_at: date = None\r\n\r\n    class Config():\r\n        orm_mode = True\r\n\r\nclass InvoiceSchema(BaseModel):\r\n    id: int\r\n    invoice_number: int\r\n    invoice_description: str\r\n    total: float\r\n    invoice_items: List[InvoiceItemSchema]\r\n\r\n    class Config():\r\n        orm_mode = True\r\n```\r\n\r\n\r\n### Description\r\n\r\nexpected result \r\n{\r\n   'id': 1\r\n   'invoice_number': 1\r\n   'item_name': this is invoice one\r\n   'invoice_items': [\r\n      {'invoice_id': 1, 'item_name': item one, deleted_at: None},\r\n      {'invoice_id': 1, 'item_name': item two, deleted_at: None}\r\n      {'invoice_id': 1, 'item_name': item three, deleted_at: None}\r\n   ]\r\n}\r\n\r\n### Operating System\r\n\r\nLinux\r\n\r\n### Operating System Details\r\n\r\nubuntu 20.04 lts\r\n\r\n### FastAPI Version\r\n\r\n0.75\r\n\r\n### Python Version\r\n\r\n3.7\r\n\r\n### Additional Context\r\n\r\n_No response_","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4716/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4716/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4712","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4712/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4712/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4712/events","html_url":"https://github.com/tiangolo/fastapi/issues/4712","id":1175896212,"node_id":"I_kwDOCZduT85GFsCU","number":4712,"title":"Content examples for application/xml are wrapped in '<notagname>'","user":{"login":"CJKinni","id":251233,"node_id":"MDQ6VXNlcjI1MTIzMw==","avatar_url":"https://avatars.githubusercontent.com/u/251233?v=4","gravatar_id":"","url":"https://api.github.com/users/CJKinni","html_url":"https://github.com/CJKinni","followers_url":"https://api.github.com/users/CJKinni/followers","following_url":"https://api.github.com/users/CJKinni/following{/other_user}","gists_url":"https://api.github.com/users/CJKinni/gists{/gist_id}","starred_url":"https://api.github.com/users/CJKinni/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CJKinni/subscriptions","organizations_url":"https://api.github.com/users/CJKinni/orgs","repos_url":"https://api.github.com/users/CJKinni/repos","events_url":"https://api.github.com/users/CJKinni/events{/privacy}","received_events_url":"https://api.github.com/users/CJKinni/received_events","type":"User","site_admin":false},"labels":[{"id":1154536363,"node_id":"MDU6TGFiZWwxMTU0NTM2MzYz","url":"https://api.github.com/repos/tiangolo/fastapi/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-03-21T20:18:45Z","updated_at":"2022-03-21T20:19:19Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### First Check\r\n\r\n- [X] I added a very descriptive title to this issue.\r\n- [X] I used the GitHub search to find a similar issue and didn't find it.\r\n- [X] I searched the FastAPI documentation, with the integrated search.\r\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n\r\n### Commit to Help\r\n\r\n- [X] I commit to help with one of those options 👆\r\n\r\n### Example Code\r\n\r\n```python\r\n@router.get(\"/{app_no}/xml\",\r\n    responses={\r\n        200: {\r\n            \"description\": \"Example description\",\r\n            \"content\": {\r\n                \"application/xml\": { \r\n                    \"example\": \"\"\"\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<CATALOG>\r\n  <CD>\r\n    <TITLE>Empire Burlesque</TITLE>\r\n    <ARTIST>Bob Dylan</ARTIST>\r\n    <COUNTRY>USA</COUNTRY>\r\n    <COMPANY>Columbia</COMPANY>\r\n    <PRICE>10.90</PRICE>\r\n    <YEAR>1985</YEAR>\r\n  </CD>\r\n</CATALOG>\"\"\",\r\n                },\r\n                \"application/json\": None\r\n            },\r\n        }\r\n    })\r\n```\r\n\r\nProduces the following example in the `/docs` UI:\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<notagname>\r\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\r\n&lt;CATALOG&gt;\r\n  &lt;CD&gt;\r\n    &lt;TITLE&gt;Empire Burlesque&lt;/TITLE&gt;\r\n    &lt;ARTIST&gt;Bob Dylan&lt;/ARTIST&gt;\r\n    &lt;COUNTRY&gt;USA&lt;/COUNTRY&gt;\r\n    &lt;COMPANY&gt;Columbia&lt;/COMPANY&gt;\r\n    &lt;PRICE&gt;10.90&lt;/PRICE&gt;\r\n    &lt;YEAR&gt;1985&lt;/YEAR&gt;\r\n  &lt;/CD&gt;\r\n&lt;/CATALOG&gt;</notagname>\r\n```\r\n```\r\n\r\n\r\n### Description\r\n\r\nI'm trying to setup an `application/xml` content example with a hardcoded response.\r\n\r\nWhen I set a response, it ends up wrapped in `notagname` tags and escaped.  What is the accepted way to hardcode an example response for an XML?\r\n\r\n### Operating System\r\n\r\nmacOS\r\n\r\n### Operating System Details\r\n\r\n_No response_\r\n\r\n### FastAPI Version\r\n\r\n0.75.0\r\n\r\n### Python Version\r\n\r\nPython 3.8.9\r\n\r\n### Additional Context\r\n\r\n_No response_","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4712/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4712/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4711","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4711/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4711/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4711/events","html_url":"https://github.com/tiangolo/fastapi/pull/4711","id":1175759076,"node_id":"PR_kwDOCZduT840wmXi","number":4711,"title":"deleting a route from APIRouter","user":{"login":"sobhansaf","id":48681804,"node_id":"MDQ6VXNlcjQ4NjgxODA0","avatar_url":"https://avatars.githubusercontent.com/u/48681804?v=4","gravatar_id":"","url":"https://api.github.com/users/sobhansaf","html_url":"https://github.com/sobhansaf","followers_url":"https://api.github.com/users/sobhansaf/followers","following_url":"https://api.github.com/users/sobhansaf/following{/other_user}","gists_url":"https://api.github.com/users/sobhansaf/gists{/gist_id}","starred_url":"https://api.github.com/users/sobhansaf/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sobhansaf/subscriptions","organizations_url":"https://api.github.com/users/sobhansaf/orgs","repos_url":"https://api.github.com/users/sobhansaf/repos","events_url":"https://api.github.com/users/sobhansaf/events{/privacy}","received_events_url":"https://api.github.com/users/sobhansaf/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-03-21T18:11:41Z","updated_at":"2022-03-25T14:35:55Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/tiangolo/fastapi/pulls/4711","html_url":"https://github.com/tiangolo/fastapi/pull/4711","diff_url":"https://github.com/tiangolo/fastapi/pull/4711.diff","patch_url":"https://github.com/tiangolo/fastapi/pull/4711.patch","merged_at":null},"body":"There are some scenarios in which someone may need to delete a route from APIRouter. For example, you may use a third-party library that provides a router for you. But you do not want to use all of the provided endpoints. In this case, it is useful to remove some of the endpoints","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4711/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4711/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4710","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4710/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4710/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4710/events","html_url":"https://github.com/tiangolo/fastapi/pull/4710","id":1175660232,"node_id":"PR_kwDOCZduT840wR7f","number":4710,"title":"Add SPDX style license identifier","user":{"login":"ccorbacho","id":1961985,"node_id":"MDQ6VXNlcjE5NjE5ODU=","avatar_url":"https://avatars.githubusercontent.com/u/1961985?v=4","gravatar_id":"","url":"https://api.github.com/users/ccorbacho","html_url":"https://github.com/ccorbacho","followers_url":"https://api.github.com/users/ccorbacho/followers","following_url":"https://api.github.com/users/ccorbacho/following{/other_user}","gists_url":"https://api.github.com/users/ccorbacho/gists{/gist_id}","starred_url":"https://api.github.com/users/ccorbacho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ccorbacho/subscriptions","organizations_url":"https://api.github.com/users/ccorbacho/orgs","repos_url":"https://api.github.com/users/ccorbacho/repos","events_url":"https://api.github.com/users/ccorbacho/events{/privacy}","received_events_url":"https://api.github.com/users/ccorbacho/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-03-21T16:50:23Z","updated_at":"2022-03-21T16:50:23Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/tiangolo/fastapi/pulls/4710","html_url":"https://github.com/tiangolo/fastapi/pull/4710","diff_url":"https://github.com/tiangolo/fastapi/pull/4710.diff","patch_url":"https://github.com/tiangolo/fastapi/pull/4710.patch","merged_at":null},"body":"Many automated scanning tools look for an SPDX style license identifier to\r\nfind the license being used by a package in an automated fashion\r\n(even though PEP 639 is still in draft).","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4710/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4710/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4709","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4709/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4709/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4709/events","html_url":"https://github.com/tiangolo/fastapi/issues/4709","id":1175278040,"node_id":"I_kwDOCZduT85GDVHY","number":4709,"title":"Support for describing OpenAPI 3.1.0 webhooks","user":{"login":"michaeloliverx","id":55017335,"node_id":"MDQ6VXNlcjU1MDE3MzM1","avatar_url":"https://avatars.githubusercontent.com/u/55017335?v=4","gravatar_id":"","url":"https://api.github.com/users/michaeloliverx","html_url":"https://github.com/michaeloliverx","followers_url":"https://api.github.com/users/michaeloliverx/followers","following_url":"https://api.github.com/users/michaeloliverx/following{/other_user}","gists_url":"https://api.github.com/users/michaeloliverx/gists{/gist_id}","starred_url":"https://api.github.com/users/michaeloliverx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/michaeloliverx/subscriptions","organizations_url":"https://api.github.com/users/michaeloliverx/orgs","repos_url":"https://api.github.com/users/michaeloliverx/repos","events_url":"https://api.github.com/users/michaeloliverx/events{/privacy}","received_events_url":"https://api.github.com/users/michaeloliverx/received_events","type":"User","site_admin":false},"labels":[{"id":1154536359,"node_id":"MDU6TGFiZWwxMTU0NTM2MzU5","url":"https://api.github.com/repos/tiangolo/fastapi/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"New feature or request"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-03-21T11:56:30Z","updated_at":"2022-03-21T11:56:30Z","closed_at":null,"author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"### First Check\n\n- [X] I added a very descriptive title to this issue.\n- [X] I used the GitHub search to find a similar issue and didn't find it.\n- [X] I searched the FastAPI documentation, with the integrated search.\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\n\n### Commit to Help\n\n- [X] I commit to help with one of those options 👆\n\n### Example Code\n\n```python\n# Example taken from https://github.com/OAI/OpenAPI-Specification/blob/main/examples/v3.1/webhook-example.yaml\r\nopenapi: 3.1.0\r\ninfo:\r\n  title: Webhook Example\r\n  version: 1.0.0\r\n# Since OAS 3.1.0 the paths element isn't necessary. Now a valid OpenAPI Document can describe only paths, webhooks, or even only reusable components\r\nwebhooks:\r\n  # Each webhook needs a name\r\n  newPet:\r\n    # This is a Path Item Object, the only difference is that the request is initiated by the API provider\r\n    post:\r\n      requestBody:\r\n        description: Information about a new pet in the system\r\n        content:\r\n          application/json:\r\n            schema:\r\n              $ref: \"#/components/schemas/Pet\"\r\n      responses:\r\n        \"200\":\r\n          description: Return a 200 status to indicate that the data was received successfully\r\n\r\ncomponents:\r\n  schemas:\r\n    Pet:\r\n      required:\r\n        - id\r\n        - name\r\n      properties:\r\n        id:\r\n          type: integer\r\n          format: int64\r\n        name:\r\n          type: string\r\n        tag:\r\n          type: string\n```\n\n\n### Description\n\nI would like to be able to describe webhooks in FastAPI as described in [OpenAPI 3.1 Webhooks](https://spec.openapis.org/oas/v3.1.0#oasWebhooks).\r\n\r\n## References\r\n- https://spec.openapis.org/oas/v3.1.0#oasWebhooks\r\n- https://github.com/OAI/OpenAPI-Specification/blob/main/examples/v3.1/webhook-example.yaml\n\n### Wanted Solution\n\nI would like an official way to use fastapi idioms to describe these webhooks and potentially add a way to hook into the setup/orchestration of said hooks.\n\n### Wanted Code\n\n```python\nfrom fastapi import FastAPI\r\n\r\napp = FastAPI()\r\n\r\n\r\n# Some way to describe webhooks...\n```\n\n\n### Alternatives\n\n_No response_\n\n### Operating System\n\nLinux, Windows, macOS\n\n### Operating System Details\n\n_No response_\n\n### FastAPI Version\n\n0.75.0\n\n### Python Version\n\n3.9.0\n\n### Additional Context\n\n_No response_","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4709/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4709/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4708","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4708/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4708/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4708/events","html_url":"https://github.com/tiangolo/fastapi/issues/4708","id":1174902361,"node_id":"I_kwDOCZduT85GB5ZZ","number":4708,"title":"Nullable Query Parameters","user":{"login":"jurasofish","id":33386122,"node_id":"MDQ6VXNlcjMzMzg2MTIy","avatar_url":"https://avatars.githubusercontent.com/u/33386122?v=4","gravatar_id":"","url":"https://api.github.com/users/jurasofish","html_url":"https://github.com/jurasofish","followers_url":"https://api.github.com/users/jurasofish/followers","following_url":"https://api.github.com/users/jurasofish/following{/other_user}","gists_url":"https://api.github.com/users/jurasofish/gists{/gist_id}","starred_url":"https://api.github.com/users/jurasofish/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jurasofish/subscriptions","organizations_url":"https://api.github.com/users/jurasofish/orgs","repos_url":"https://api.github.com/users/jurasofish/repos","events_url":"https://api.github.com/users/jurasofish/events{/privacy}","received_events_url":"https://api.github.com/users/jurasofish/received_events","type":"User","site_admin":false},"labels":[{"id":1154536363,"node_id":"MDU6TGFiZWwxMTU0NTM2MzYz","url":"https://api.github.com/repos/tiangolo/fastapi/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2022-03-21T05:17:44Z","updated_at":"2022-03-24T23:45:59Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### First Check\r\n\r\n- [X] I added a very descriptive title to this issue.\r\n- [X] I used the GitHub search to find a similar issue and didn't find it.\r\n- [X] I searched the FastAPI documentation, with the integrated search.\r\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n\r\n### Commit to Help\r\n\r\n- [X] I commit to help with one of those options 👆\r\n\r\n### Example Code\r\n\r\n```python\r\nfrom typing import Optional\r\n\r\nfrom fastapi import FastAPI\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.get(\"/\")\r\ndef home(q: Optional[bool] = True):\r\n    return {\"Hello\": q}\r\n\r\nimport uvicorn\r\nuvicorn.run(app, host=\"127.0.0.1\", port=5001)\r\n```\r\n\r\n\r\n### Description\r\n\r\nI have a simple FastAPI route with an `Optional[bool]` query parameter.\r\nI would like to pass `None` as the value to the parameter. \r\n\r\nI've tried all the following but in every case it is rejected with the messager `{\"detail\":[{\"loc\":[\"query\",\"q\"],\"msg\":\"value could not be parsed to a boolean\",\"type\":\"type_error.bool\"}]}`\r\n\r\n- `GET /q=`\r\n- `GET /q`\r\n- `GET /q=null`\r\n- `GET /q=none`\r\n\r\n\r\nIs there any way to pass `None` other that setting it as the default value?\r\n\r\n### Operating System\r\n\r\nmacOS\r\n\r\n### Operating System Details\r\n\r\n_No response_\r\n\r\n### FastAPI Version\r\n\r\n0.73.0\r\n\r\n### Python Version\r\n\r\nPython 3.9.7\r\n\r\n### Additional Context\r\n\r\n_No response_","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4708/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4708/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4707","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4707/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4707/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4707/events","html_url":"https://github.com/tiangolo/fastapi/issues/4707","id":1174732435,"node_id":"I_kwDOCZduT85GBP6T","number":4707,"title":"Return in response_model additional info (like Pydantic schema - field title, type etc.)","user":{"login":"alispa","id":16710289,"node_id":"MDQ6VXNlcjE2NzEwMjg5","avatar_url":"https://avatars.githubusercontent.com/u/16710289?v=4","gravatar_id":"","url":"https://api.github.com/users/alispa","html_url":"https://github.com/alispa","followers_url":"https://api.github.com/users/alispa/followers","following_url":"https://api.github.com/users/alispa/following{/other_user}","gists_url":"https://api.github.com/users/alispa/gists{/gist_id}","starred_url":"https://api.github.com/users/alispa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alispa/subscriptions","organizations_url":"https://api.github.com/users/alispa/orgs","repos_url":"https://api.github.com/users/alispa/repos","events_url":"https://api.github.com/users/alispa/events{/privacy}","received_events_url":"https://api.github.com/users/alispa/received_events","type":"User","site_admin":false},"labels":[{"id":1154536359,"node_id":"MDU6TGFiZWwxMTU0NTM2MzU5","url":"https://api.github.com/repos/tiangolo/fastapi/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"New feature or request"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-03-20T23:50:17Z","updated_at":"2022-03-20T23:55:47Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### First Check\r\n\r\n- [X] I added a very descriptive title to this issue.\r\n- [X] I used the GitHub search to find a similar issue and didn't find it.\r\n- [X] I searched the FastAPI documentation, with the integrated search.\r\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n\r\n### Commit to Help\r\n\r\n- [X] I commit to help with one of those options 👆\r\n\r\n### Example Code\r\n\r\n```python\r\nfrom fastapi import FastAPI\r\nfrom pydantic import BaseModel, Field\r\nfrom typing import List\r\n\r\napp = FastAPI()\r\n\r\nclass Item(BaseModel):\r\n    name: str = Field(title=\"Product name\")\r\n    description: str = Field(title=\"Product description\")\r\n\r\n@app.get(\"/items\", response_model=List[Item])\r\nasync def get_items():\r\n    return get_all_items_from_db()\r\n```\r\n\r\n\r\n### Description\r\n\r\n* I call the enpoint `/items`\r\n* it has `response_model=List[Item]`\r\n* it returns:\r\n```\r\n[\r\n  {name: \"apple\", description: \"amazing\"},\r\n  {name: \"banana\", description: \"also amazing\"},\r\n]\r\n```\r\n* I am trying at the frontend to use field titles instead of the keys (`name`, `description`) that I now get.\r\n\r\n### Wanted Solution\r\n\r\n1) I would like `response_model={\"fields_info\": Item.schema(), \"values\": List[Item]}`\r\nEXAMPLE:\r\n```\r\n{\r\n  fields_info: {\r\n    name: {title: \"Product name\", type: \"string\"},\r\n    description: {title: \"Product description\", type: \"string\"}\r\n  },\r\n  values: [\r\n    {name: \"apple\", description: \"amazing\"},\r\n    {name: \"banana\", description: \"also amazing\"},\r\n  ]\r\n}\r\n```\r\n\r\n2) To make this response schema visible in the docs\r\n\r\n\r\n### Wanted Code\r\n\r\n```python\r\n@app.get(\"/items\", response_model={\"fields_info\": Item.schema(), \"values\": List[Item]})\r\nasync def get_items():\r\n    return get_all_items_from_db()\r\n```\r\n\r\n\r\n### Alternatives\r\n\r\n_No response_\r\n\r\n### Operating System\r\n\r\nWindows\r\n\r\n### Operating System Details\r\n\r\n_No response_\r\n\r\n### FastAPI Version\r\n\r\n0.70.0\r\n\r\n### Python Version\r\n\r\n3.10.0\r\n\r\n### Additional Context\r\n\r\n_No response_","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4707/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4707/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4706","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4706/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4706/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4706/events","html_url":"https://github.com/tiangolo/fastapi/issues/4706","id":1174678154,"node_id":"I_kwDOCZduT85GBCqK","number":4706,"title":"What is the best practice for enabling runtime config from command line during fast-api app launch?","user":{"login":"napsternxg","id":112678,"node_id":"MDQ6VXNlcjExMjY3OA==","avatar_url":"https://avatars.githubusercontent.com/u/112678?v=4","gravatar_id":"","url":"https://api.github.com/users/napsternxg","html_url":"https://github.com/napsternxg","followers_url":"https://api.github.com/users/napsternxg/followers","following_url":"https://api.github.com/users/napsternxg/following{/other_user}","gists_url":"https://api.github.com/users/napsternxg/gists{/gist_id}","starred_url":"https://api.github.com/users/napsternxg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/napsternxg/subscriptions","organizations_url":"https://api.github.com/users/napsternxg/orgs","repos_url":"https://api.github.com/users/napsternxg/repos","events_url":"https://api.github.com/users/napsternxg/events{/privacy}","received_events_url":"https://api.github.com/users/napsternxg/received_events","type":"User","site_admin":false},"labels":[{"id":1154536363,"node_id":"MDU6TGFiZWwxMTU0NTM2MzYz","url":"https://api.github.com/repos/tiangolo/fastapi/labels/question","name":"question","color":"d876e3","default":true,"description":"Further information is requested"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2022-03-20T20:39:33Z","updated_at":"2022-03-28T23:35:00Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### First Check\n\n- [X] I added a very descriptive title to this issue.\n- [X] I used the GitHub search to find a similar issue and didn't find it.\n- [X] I searched the FastAPI documentation, with the integrated search.\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\n\n### Commit to Help\n\n- [X] I commit to help with one of those options 👆\n\n### Example Code\n\n```python\ndef main(args):\r\n    model_path = args[1]\r\n    model = load_model(model_path)\r\n    app = FastAPI()\r\n    \r\n    @app.get(\"/{item_id}\")\r\n    def predict_item(item_id: int):\r\n        return dict(item_id=item_id, prediction=model(item_id))\r\n    \r\n    uvicorn.run(app)\r\n\r\nif __name__ == \"__main__\":\r\n    args = sys.argv\r\n    print(args)\r\n    main(args)\n```\n\n\n### Description\n\nHi \r\nFastAPI team, \r\n\r\nI just started using FastAPI and I am liking it. \r\nI would like to know what is the best practice for enabling runtime config from command line during fast-api app launch. \r\nI would like to have a library which I can share with my team mates so that they can serve their models via fast-api by just changing the model path. \r\n\r\nHowever, right now I am creating the `app = FastApi()` inside a function e.g. `main`, which can read the command line args and then and defining all the `app` end points under this `main` function. This makes it harder to test the `app` endpoint functions defined inside `main`. \r\n\r\nI am doing something like the code example above. But I think there must be a better way.\r\n\r\nI looked at FastAPI docs and I saw `from fastapi import Depends` may help with this but I am not sure how to use it for the setup I have above. \r\nEffectively I would like to know if there is a pattern which is cleaner, e.g. something like this:\r\n\r\n```python\r\napp = FastAPI()\r\n    \r\n@app.get(\"/{item_id}\", model = Depends(something))\r\ndef predict_item(item_id: int):\r\n   # Somehow get this model properly defined outside of main\r\n    return dict(item_id=item_id, prediction=model(item_id))\r\n\r\n\r\n\r\ndef main(args):\r\n    model_path = args[1]\r\n    model = load_model(model_path)\r\n\r\n   # configure app to use model. \r\n   \r\n    \r\n    uvicorn.run(app)\r\n\r\nif __name__ == \"__main__\":\r\n    args = sys.argv\r\n    print(args)\r\n    main(args)\r\n```\r\n\r\n\r\n\r\nAlso asked this question on Twitter at [@FastAPI](https://twitter.com/FastAPI): https://twitter.com/FastAPI/status/1505619967311499264\n\n### Operating System\n\nLinux\n\n### Operating System Details\n\n_No response_\n\n### FastAPI Version\n\n0.75.0\n\n### Python Version\n\n3.7.11\n\n### Additional Context\n\n_No response_","reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4706/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4706/timeline","performed_via_github_app":null},{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4705","repository_url":"https://api.github.com/repos/tiangolo/fastapi","labels_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4705/labels{/name}","comments_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4705/comments","events_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4705/events","html_url":"https://github.com/tiangolo/fastapi/pull/4705","id":1174520566,"node_id":"PR_kwDOCZduT840syQ9","number":4705,"title":"add indonesian translation for docs/id/docs/tutorial/index.md","user":{"login":"bas-baskara","id":41407847,"node_id":"MDQ6VXNlcjQxNDA3ODQ3","avatar_url":"https://avatars.githubusercontent.com/u/41407847?v=4","gravatar_id":"","url":"https://api.github.com/users/bas-baskara","html_url":"https://github.com/bas-baskara","followers_url":"https://api.github.com/users/bas-baskara/followers","following_url":"https://api.github.com/users/bas-baskara/following{/other_user}","gists_url":"https://api.github.com/users/bas-baskara/gists{/gist_id}","starred_url":"https://api.github.com/users/bas-baskara/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bas-baskara/subscriptions","organizations_url":"https://api.github.com/users/bas-baskara/orgs","repos_url":"https://api.github.com/users/bas-baskara/repos","events_url":"https://api.github.com/users/bas-baskara/events{/privacy}","received_events_url":"https://api.github.com/users/bas-baskara/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-03-20T11:47:09Z","updated_at":"2022-03-23T20:21:04Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/tiangolo/fastapi/pulls/4705","html_url":"https://github.com/tiangolo/fastapi/pull/4705","diff_url":"https://github.com/tiangolo/fastapi/pull/4705.diff","patch_url":"https://github.com/tiangolo/fastapi/pull/4705.patch","merged_at":null},"body":null,"reactions":{"url":"https://api.github.com/repos/tiangolo/fastapi/issues/4705/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tiangolo/fastapi/issues/4705/timeline","performed_via_github_app":null}]